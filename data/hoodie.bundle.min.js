!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hoodie=e()}}(function(){var e,t,n;return function r(e,t,n){function o(s,a){if(!t[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n?n:t)},l,l.exports,r,e,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,i,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),u=1;r>u;u++)i[u-1]=arguments[u];n.apply(this,i)}else if(s(n)){for(r=arguments.length,i=new Array(r-1),u=1;r>u;u++)i[u-1]=arguments[u];for(c=n.slice(),r=c.length,u=0;r>u;u++)c[u].apply(this,i)}return!0},r.prototype.addListener=function(e,t){var n;if(!o(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,i,a;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,r=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=i;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?o(e._events[t])?1:e._events[t].length:0}},{}],2:[function(t,n,r){(function(t,o){!function(t){if("object"==typeof r&&"undefined"!=typeof n)n.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof o?i=o:"undefined"!=typeof self&&(i=self),i.Promise=t()}}(function(){var e,n,r;return function i(e,t,n){function r(s,a){if(!t[s]){if(!e[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return r(n?n:t)},l,l.exports,i,e,t,n)}return t[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){"use strict";function r(){this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=c.isStatic?c(this.drainQueues):c}function o(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function i(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var a;try{throw new Error}catch(u){a=u}var c=e("./schedule.js"),l=e("./queue.js"),f=e("./util.js");r.prototype.disableTrampolineIfNecessary=function(){f.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(e){setTimeout(e,0)})},r.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},r.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(n){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},f.hasDevTools?(c.isStatic&&(c=function(e){setTimeout(e,0)}),r.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},r.prototype.invoke=function(e,t,n){this._trampolineEnabled?i.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},r.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(r.prototype.invokeLater=o,r.prototype.invoke=i,r.prototype.settlePromises=s),r.prototype.invokeFirst=function(e,t,n){this._normalQueue.unshift(e,t,n),this._queueTick()},r.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},t.exports=new r,t.exports.firstLineError=a},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n){var r=function(e,t){this._reject(t)},o=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(r,r,null,this,e)},i=function(e,t){this._isPending()&&this._resolveCallback(t.target)},s=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(r){var a=n(r),u=new e(t);u._propagateFrom(this,1);var c=this._target();if(u._setBoundTo(a),a instanceof e){var l={promiseRejectionQueued:!1,promise:u,target:c,bindingPromise:a};c._then(t,o,u._progress,u,l),a._then(i,s,u._progress,u,l)}else u._resolveCallback(c);return u},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=131072|this._bitField,this._boundTo=e):this._bitField=-131073&this._bitField},e.prototype._isBound=function(){return 131072===(131072&this._bitField)},e.bind=function(r,o){var i=n(r),s=new e(t);return s._setBoundTo(i),i instanceof e?i._then(function(){s._resolveCallback(o)},s._reject,s._progress,s,null):s._resolveCallback(o),s}}},{}],4:[function(e,t,n){"use strict";function r(){try{Promise===i&&(Promise=o)}catch(e){}return i}var o;"undefined"!=typeof Promise&&(o=Promise);var i=e("./promise.js")();i.noConflict=r,t.exports=i},{"./promise.js":23}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var o=r(null),i=r(null);o[" size"]=i[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var o="Object "+a.classString(e)+" has no method '"+a.toString(n)+"'";throw new t.TypeError(o)}return r}function r(e){var t=this.pop(),r=n(e,t);return r.apply(e,this)}function o(e){return e[this]}function i(e){var t=+this;return 0>t&&(t=Math.max(0,t+e.length)),e[t]}var s,a=e("./util.js"),u=a.canEvaluate;a.isIdentifier;t.prototype.call=function(e){for(var t=arguments.length,n=new Array(t-1),o=1;t>o;++o)n[o-1]=arguments[o];return n.push(e),this._then(r,void 0,void 0,n,void 0)},t.prototype.get=function(e){var t,n="number"==typeof e;if(n)t=i;else if(u){var r=s(e);t=null!==r?r:o}else t=o;return this._then(t,void 0,void 0,e,void 0)}}},{"./util.js":38}],6:[function(e,t,n){"use strict";t.exports=function(t){var n=e("./errors.js"),r=e("./async.js"),o=n.CancellationError;t.prototype._cancel=function(e){if(!this.isCancellable())return this;for(var t,n=this;void 0!==(t=n._cancellationParent)&&t.isCancellable();)n=t;this._unsetCancellable(),n._target()._rejectCallback(e,!1,!0)},t.prototype.cancel=function(e){return this.isCancellable()?(void 0===e&&(e=new o),r.invokeLater(this._cancel,this,e),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(r.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var e=this.then();return e._unsetCancellable(),e},t.prototype.fork=function(e,t,n){var r=this._then(e,t,n,void 0,void 0);return r._setCancellable(),r._cancellationParent=void 0,r}}},{"./async.js":2,"./errors.js":13}],7:[function(e,n,r){"use strict";n.exports=function(){function n(e){this._parent=e;var t=this._length=1+(void 0===e?0:e._length);j(this,n),t>32&&this.uncycle()}function r(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function o(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function i(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],o=t.length-1,i=t[o],s=-1,a=r.length-1;a>=0;--a)if(r[a]===i){s=a;break}for(var a=s;a>=0;--a){var u=r[a];if(t[o]!==u)break;t.pop(),o--}t=r}}function s(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],o=v.test(r)||"    (No stack trace)"===r,i=o&&m(r);o&&!i&&(_&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function a(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||v.test(r))break}return n>0&&(t=t.slice(n)),t}function u(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(t))try{var r=JSON.stringify(e);t=r}catch(o){}0===t.length&&(t="(empty array)")}return"(<"+c(t)+">, no stack trace)"}function c(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function l(e){var t=e.match(y);return t?{fileName:t[1],line:parseInt(t[2],10)}:void 0}var f,d=e("./async.js"),p=e("./util.js"),h=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,v=null,g=null,_=!1;p.inherits(n,Error),n.prototype.uncycle=function(){var e=this._length;if(!(2>e)){for(var t=[],n={},r=0,o=this;void 0!==o;++r)t.push(o),o=o._parent;e=this._length=r;for(var r=e-1;r>=0;--r){var i=t[r].stack;void 0===n[i]&&(n[i]=r)}for(var r=0;e>r;++r){var s=t[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var u=r>0?t[r-1]:this;e-1>a?(u._parent=t[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,l=r-2;l>=0;--l)t[l]._length=c,c++;return}}}},n.prototype.parent=function(){return this._parent},n.prototype.hasParent=function(){return void 0!==this._parent},n.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=n.parseStackAndMessage(e),a=t.message,u=[t.stack],c=this;void 0!==c;)u.push(s(c.stack.split("\n"))),c=c._parent;i(u),o(u),p.notEnumerableProp(e,"stack",r(a,u)),p.notEnumerableProp(e,"__stackCleaned__",!0)}},n.parseStackAndMessage=function(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?a(e):["    (No stack trace)"],{message:n,stack:s(t)}},n.formatAndLogError=function(e,t){if("undefined"!=typeof console){var n;if("object"==typeof e||"function"==typeof e){var r=e.stack;n=t+g(r,e)}else n=t+String(e);"function"==typeof f?f(n):("function"==typeof console.log||"object"==typeof console.log)&&console.log(n)}},n.unhandledRejection=function(e){n.formatAndLogError(e,"^--- With additional stack trace: ")},n.isSupported=function(){return"function"==typeof j},n.fireRejectionEvent=function(e,t,r,o){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(o):t(r,o))}catch(s){d.throwLater(s)}var a=!1;try{a=w(e,r,o)}catch(s){a=!0,d.throwLater(s)}var u=!1;if(b)try{u=b(e.toLowerCase(),{reason:r,promise:o})}catch(s){u=!0,d.throwLater(s)}a||i||u||"unhandledRejection"!==e||n.formatAndLogError(r,"Unhandled rejection ")};var m=function(){return!1},y=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;n.setBounds=function(e,t){if(n.isSupported()){for(var r,o,i=e.stack.split("\n"),s=t.stack.split("\n"),a=-1,u=-1,c=0;c<i.length;++c){var f=l(i[c]);if(f){r=f.fileName,a=f.line;break}}for(var c=0;c<s.length;++c){var f=l(s[c]);if(f){o=f.fileName,u=f.line;break}}0>a||0>u||!r||!o||r!==o||a>=u||(m=function(e){if(h.test(e))return!0;var t=l(e);return t&&t.fileName===r&&a<=t.line&&t.line<=u?!0:!1})}};var b,j=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():u(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,v=e,g=t;var n=Error.captureStackTrace;return m=function(e){return h.test(e)},function(e,t){Error.stackTraceLimit=Error.stackTraceLimit+6,n(e,t),Error.stackTraceLimit=Error.stackTraceLimit-6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return v=/@/,g=t,_=!0,function(e){e.stack=(new Error).stack};var o;try{throw new Error}catch(i){o="stack"in i}return"stack"in r||!o||"number"!=typeof Error.stackTraceLimit?(g=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?u(t):t.toString()},null):(v=e,g=t,function(e){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit=Error.stackTraceLimit-6})}([]),w=function(){if(p.isNode)return function(e,n,r){return"rejectionHandled"===e?t.emit(e,r):t.emit(e,n,r)};var e=!1,n=!0;try{var r=new self.CustomEvent("test");e=r instanceof CustomEvent}catch(o){}if(!e)try{var i=document.createEvent("CustomEvent");i.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(i)}catch(o){n=!1}n&&(b=function(t,n){var r;return e?r=new self.CustomEvent(t,{detail:n,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(r=document.createEvent("CustomEvent"),r.initCustomEvent(t,!1,!0,n)),r?!self.dispatchEvent(r):!1});var s={};return s.unhandledRejection="onunhandledRejection".toLowerCase(),s.rejectionHandled="onrejectionHandled".toLowerCase(),function(e,t,n){var r=s[e],o=self[r];return o?("rejectionHandled"===e?o.call(self,n):o.call(self,t,n),!0):!1}}();return"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(f=function(e){console.warn(e)},p.isNode&&t.stderr.isTTY?f=function(e){t.stderr.write("[31m"+e+"[39m\n")}:p.isNode||"string"!=typeof(new Error).stack||(f=function(e){console.warn("%c"+e,"color: red")})),n}},{"./async.js":2,"./util.js":38}],8:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t,n){this._instances=e,this._callback=t,this._promise=n}function r(e,t){var n={},r=s(e).call(n,t);if(r===a)return r;var o=u(n);return o.length?(a.e=new c("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),a):r}var o=e("./util.js"),i=e("./errors.js"),s=o.tryCatch,a=o.errorObj,u=e("./es5.js").keys,c=i.TypeError;return n.prototype.doFilter=function(e){for(var n=this._callback,o=this._promise,i=o._boundValue(),u=0,c=this._instances.length;c>u;++u){var l=this._instances[u],f=l===Error||null!=l&&l.prototype instanceof Error;if(f&&e instanceof l){var d=s(n).call(i,e);return d===a?(t.e=d.e,t):d}if("function"==typeof l&&!f){var p=r(l,e);if(p===a){e=a.e;break}if(p){var d=s(n).call(i,e);return d===a?(t.e=d.e,t):d}}}return t.e=e,t},n}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(e,t,n){"use strict";t.exports=function(e,t,n){function r(){this._trace=new t(i())}function o(){return n()?new r:void 0}function i(){var e=s.length-1;return e>=0?s[e]:void 0}var s=[];return r.prototype._pushContext=function(){n()&&void 0!==this._trace&&s.push(this._trace)},r.prototype._popContext=function(){n()&&void 0!==this._trace&&s.pop()},e.prototype._peekContext=i,e.prototype._pushContext=r.prototype._pushContext,e.prototype._popContext=r.prototype._popContext,o}},{}],10:[function(e,n,r){"use strict";n.exports=function(n,r){var o,i,s=n._getDomain,a=e("./async.js"),u=e("./errors.js").Warning,c=e("./util.js"),l=c.canAttachTrace,f=c.isNode&&(!!t.env.BLUEBIRD_DEBUG||"development"===t.env.NODE_ENV);return c.isNode&&0==t.env.BLUEBIRD_DEBUG&&(f=!1),f&&a.disableTrampolineIfNecessary(),n.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=16777216|this._bitField},n.prototype._ensurePossibleRejectionHandled=function(){0===(16777216&this._bitField)&&(this._setRejectionIsUnhandled(),a.invokeLater(this._notifyUnhandledRejection,this,void 0))},n.prototype._notifyUnhandledRejectionIsHandled=function(){r.fireRejectionEvent("rejectionHandled",o,void 0,this)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),r.fireRejectionEvent("unhandledRejection",i,e,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},n.prototype._setCarriedStackTrace=function(e){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=e},n.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},n.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},n.prototype._captureStackTrace=function(){return f&&(this._trace=new r(this._peekContext())),this},n.prototype._attachExtraTrace=function(e,t){if(f&&l(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var o=r.parseStackAndMessage(e);c.notEnumerableProp(e,"stack",o.message+"\n"+o.stack.join("\n")),c.notEnumerableProp(e,"__stackCleaned__",!0)}}},n.prototype._warn=function(e){var t=new u(e),n=this._peekContext();if(n)n.attachExtraTrace(t);else{var o=r.parseStackAndMessage(t);t.stack=o.message+"\n"+o.stack.join("\n")}r.formatAndLogError(t,"")},n.onPossiblyUnhandledRejection=function(e){var t=s();i="function"==typeof e?null===t?e:t.bind(e):void 0},n.onUnhandledRejectionHandled=function(e){var t=s();o="function"==typeof e?null===t?e:t.bind(e):void 0},n.longStackTraces=function(){if(a.haveItemsQueued()&&f===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");f=r.isSupported(),f&&a.disableTrampolineIfNecessary()},n.hasLongStackTraces=function(){return f&&r.isSupported()},r.isSupported()||(n.longStackTraces=function(){},f=!1),function(){return f}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(e,t,n){"use strict";var r=e("./util.js"),o=r.isPrimitive;t.exports=function(e){var t=function(){return this},n=function(){throw this},r=function(){},i=function(){throw void 0},s=function(e,t){return 1===t?function(){throw e}:2===t?function(){return e}:void 0};e.prototype["return"]=e.prototype.thenReturn=function(n){return void 0===n?this.then(r):o(n)?this._then(s(n,2),void 0,void 0,void 0,void 0):(n instanceof e&&n._ignoreRejections(),this._then(t,void 0,void 0,n,void 0))},e.prototype["throw"]=e.prototype.thenThrow=function(e){return void 0===e?this.then(i):o(e)?this._then(s(e,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,e,void 0)}}},{"./util.js":38}],12:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.reduce;e.prototype.each=function(e){return n(this,e,null,t)},e.each=function(e,r){return n(e,r,null,t)}}},{}],13:[function(e,t,n){"use strict";function r(e,t){function n(r){return this instanceof n?(f(this,"message","string"==typeof r?r:t),f(this,"name",e),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(r)}return l(n,Error),n}function o(e){return this instanceof o?(f(this,"name","OperationalError"),f(this,"message",e),this.cause=e,this.isOperational=!0,void(e instanceof Error?(f(this,"message",e.message),f(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new o(e)}var i,s,a=e("./es5.js"),u=a.freeze,c=e("./util.js"),l=c.inherits,f=c.notEnumerableProp,d=r("Warning","warning"),p=r("CancellationError","cancellation error"),h=r("TimeoutError","timeout error"),v=r("AggregateError","aggregate error");try{i=TypeError,s=RangeError}catch(g){i=r("TypeError","type error"),s=r("RangeError","range error")}for(var _="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<_.length;++m)"function"==typeof Array.prototype[_[m]]&&(v.prototype[_[m]]=Array.prototype[_[m]]);a.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var y=0;v.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",o=r.split("\n"),i=0;i<o.length;++i)o[i]=e+o[i];r=o.join("\n"),t+=r+"\n"}return y--,t},l(o,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:p,TimeoutError:h,OperationalError:o,RejectionError:o,AggregateError:v}),f(Error,"__BluebirdErrorTypes__",b)),t.exports={Error:Error,TypeError:i,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:d}},{"./es5.js":14,"./util.js":38}],14:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var o={}.hasOwnProperty,i={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t},u=function(e,t){return{value:e[t]}},c=function(e,t,n){return e[t]=n.value,e},l=function(e){return e},f=function(e){try{return Object(e).constructor.prototype}catch(t){return s}},d=function(e){try{return"[object Array]"===i.call(e)}catch(t){return!1}};t.exports={isArray:d,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:f,isES5:r,propertyIsWritable:function(){return!0}}}},{}],15:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,o){return n(e,r,o,t)}}},{}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r){function o(){return this}function i(){throw this}function s(e){return function(){return e}}function a(e){return function(){throw e}}function u(e,t,n){var r;return r=d(t)?n?s(t):a(t):n?o:i,e._then(r,p,void 0,t,void 0)}function c(e){var o=this.promise,i=this.handler,s=o._isBound()?i.call(o._boundValue()):i();if(void 0!==s){var a=r(s,o);if(a instanceof t)return a=a._target(),u(a,e,o.isFulfilled())}return o.isRejected()?(n.e=e,n):e}function l(e){var n=this.promise,o=this.handler,i=n._isBound()?o.call(n._boundValue(),e):o(e);if(void 0!==i){var s=r(i,n);if(s instanceof t)return s=s._target(),u(s,e,!0)}return e}var f=e("./util.js"),d=f.isPrimitive,p=f.thrower;t.prototype._passThroughHandler=function(e,t){if("function"!=typeof e)return this.then();var n={promise:this,handler:e};return this._then(t?c:l,t?c:void 0,void 0,n,void 0)},t.prototype.lastly=t.prototype["finally"]=function(e){return this._passThroughHandler(e,!0)},t.prototype.tap=function(e){return this._passThroughHandler(e,!1)}}},{"./util.js":38}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){function i(e,n,r){for(var i=0;i<n.length;++i){r._pushContext();var s=f(n[i])(e);if(r._popContext(),s===l){r._pushContext();var a=t.reject(l.e);return r._popContext(),a}var u=o(s,r);if(u instanceof t)return u}return null}function s(e,n,o,i){var s=this._promise=new t(r);s._captureStackTrace(),this._stack=i,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof o?[o].concat(d):d}var a=e("./errors.js"),u=a.TypeError,c=e("./util.js"),l=c.errorObj,f=c.tryCatch,d=[];s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},s.prototype._continue=function(e){if(e===l)return this._promise._rejectCallback(e.e,!1,!0);var n=e.value;if(e.done===!0)this._promise._resolveCallback(n);else{var r=o(n,this._promise);if(!(r instanceof t)&&(r=i(r,this._yieldHandlers,this._promise),null===r))return void this._throw(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",n)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));r._then(this._next,this._throw,void 0,this,null)}},s.prototype._throw=function(e){this._promise._attachExtraTrace(e),this._promise._pushContext();var t=f(this._generator["throw"]).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._next=function(e){this._promise._pushContext();var t=f(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},t.coroutine=function(e,t){if("function"!=typeof e)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var n=Object(t).yieldHandler,r=s,o=(new Error).stack;return function(){var t=e.apply(this,arguments),i=new r(void 0,void 0,n,o);return i._generator=t,i._next(void 0),i.promise()}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new u("fn must be a function\n\n    See http://goo.gl/916lJJ\n");d.push(e)},t.spawn=function(e){if("function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var r=new s(e,this),o=r.promise();return r._run(t.spawn),o}}},{"./errors.js":13,"./util.js":38}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){var i=e("./util.js");i.canEvaluate,i.tryCatch,i.errorObj;t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var r}for(var o=arguments.length,i=new Array(o),s=0;o>s;++s)i[s]=arguments[s];e&&i.pop();var r=new n(i).promise();return void 0!==e?r.spread(e):r}}},{"./util.js":38}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,o,i){function s(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var o=c();this._callback=null===o?t:o.bind(t),this._preservedValues=r===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:v,l.invoke(a,this,void 0)}function a(){this._init$(void 0,-2)}function u(e,t,n,r){var o="object"==typeof n&&null!==n?n.concurrency:0;return o="number"==typeof o&&isFinite(o)&&o>=1?o:0,new s(e,t,o,r)}var c=t._getDomain,l=e("./async.js"),f=e("./util.js"),d=f.tryCatch,p=f.errorObj,h={},v=[];f.inherits(s,n),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,n){var r=this._values,i=this.length(),s=this._preservedValues,a=this._limit;if(r[n]===h){if(r[n]=e,a>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(a>=1&&this._inFlight>=a)return r[n]=e,void this._queue.push(n);null!==s&&(s[n]=e);var u=this._callback,c=this._promise._boundValue();this._promise._pushContext();var l=d(u).call(c,e,n,i);if(this._promise._popContext(),l===p)return this._reject(l.e);var f=o(l,this._promise);if(f instanceof t){if(f=f._target(),f._isPending())return a>=1&&this._inFlight++,r[n]=h,f._proxyPromiseArray(this,n);if(!f._isFulfilled())return this._reject(f._reason());l=f._value()}r[n]=l}var v=++this._totalResolved;v>=i&&(null!==s?this._filter(r,s):this._resolve(r))},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),o=0,i=0;n>i;++i)e[i]&&(r[o++]=t[i]);r.length=o,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return"function"!=typeof e?r("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):u(this,e,t,null).promise()},t.map=function(e,t,n,o){return"function"!=typeof t?r("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):u(e,t,n,o).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){var i=e("./util.js"),s=i.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var o=s(e).apply(this,arguments);return r._popContext(),r._resolveFromSyncValue(o),r}},t.attempt=t["try"]=function(e,r,a){if("function"!=typeof e)return o("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var u=new t(n);u._captureStackTrace(),u._pushContext();var c=i.isArray(r)?s(e).apply(a,r):s(e).call(a,r);return u._popContext(),u._resolveFromSyncValue(c),u},t.prototype._resolveFromSyncValue=function(e){e===i.errorObj?this._rejectCallback(e.e,!1,!0):this._resolveCallback(e,!0)}}},{"./util.js":38}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){var n=this;if(!i.isArray(e))return r.call(n,e,t);var o=a(t).apply(n._boundValue(),[null].concat(e));o===u&&s.throwLater(o.e);
}function r(e,t){var n=this,r=n._boundValue(),o=void 0===e?a(t).call(r,null):a(t).call(r,null,e);o===u&&s.throwLater(o.e)}function o(e,t){var n=this;if(!e){var r=n._target(),o=r._getCarriedStackTrace();o.cause=e,e=o}var i=a(t).call(n._boundValue(),e);i===u&&s.throwLater(i.e)}var i=e("./util.js"),s=e("./async.js"),a=i.tryCatch,u=i.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var i=r;void 0!==t&&Object(t).spread&&(i=n),this._then(i,o,void 0,this,e)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(e,t,n){"use strict";t.exports=function(t,n){var r=e("./util.js"),o=e("./async.js"),i=r.tryCatch,s=r.errorObj;t.prototype.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0)},t.prototype._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(e)},t.prototype._progressHandlerAt=function(e){return 0===e?this._progressHandler0:this[(e<<2)+e-5+2]},t.prototype._doProgressWith=function(e){var n=e.value,o=e.handler,a=e.promise,u=e.receiver,c=i(o).call(u,n);if(c===s){if(null!=c.e&&"StopProgressPropagation"!==c.e.name){var l=r.canAttachTrace(c.e)?c.e:new Error(r.toString(c.e));a._attachExtraTrace(l),a._progress(c.e)}}else c instanceof t?c._then(a._progress,null,null,a,void 0):a._progress(c)},t.prototype._progressUnchecked=function(e){for(var r=this._length(),i=this._progress,s=0;r>s;s++){var a=this._progressHandlerAt(s),u=this._promiseAt(s);if(u instanceof t)"function"==typeof a?o.invoke(this._doProgressWith,this,{handler:a,promise:u,receiver:this._receiverAt(s),value:e}):o.invoke(i,u,e);else{var c=this._receiverAt(s);"function"==typeof a?a.call(c,e,u):c instanceof n&&!c._isResolved()&&c._promiseProgressed(e,u)}}}}},{"./async.js":2,"./util.js":38}],23:[function(e,n,r){"use strict";n.exports=function(){function n(e){if("function"!=typeof e)throw new d("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==n)throw new d("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,e!==p&&this._resolveFromResolver(e)}function r(e){var t=new n(p);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._progressHandler0=e,t._promise0=e,t._receiver0=e,t._settledValue=e}var o,i=function(){return new d("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},s=function(){return new n.PromiseInspection(this._target())},a=function(e){return n.reject(new d(e))},u=e("./util.js");o=u.isNode?function(){var e=t.domain;return void 0===e&&(e=null),e}:function(){return null},u.notEnumerableProp(n,"_getDomain",o);var c={},l=e("./async.js"),f=e("./errors.js"),d=n.TypeError=f.TypeError;n.RangeError=f.RangeError,n.CancellationError=f.CancellationError,n.TimeoutError=f.TimeoutError,n.OperationalError=f.OperationalError,n.RejectionError=f.OperationalError,n.AggregateError=f.AggregateError;var p=function(){},h={},v={e:null},g=e("./thenables.js")(n,p),_=e("./promise_array.js")(n,p,g,a),m=e("./captured_trace.js")(),y=e("./debuggability.js")(n,m),b=e("./context.js")(n,m,y),j=e("./catch_filter.js")(v),w=e("./promise_resolver.js"),A=w._nodebackForPromise,k=u.errorObj,E=u.tryCatch;return n.prototype.toString=function(){return"[object Promise]"},n.prototype.caught=n.prototype["catch"]=function(e){var t=arguments.length;if(t>1){var r,o=new Array(t-1),i=0;for(r=0;t-1>r;++r){var s=arguments[r];if("function"!=typeof s)return n.reject(new d("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));o[i++]=s}o.length=i,e=arguments[r];var a=new j(o,e,this);return this._then(void 0,a.doFilter,void 0,a,void 0)}return this._then(void 0,e,void 0,void 0,void 0)},n.prototype.reflect=function(){return this._then(s,s,void 0,this,void 0)},n.prototype.then=function(e,t,n){if(y()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+u.classString(e);arguments.length>1&&(r+=", "+u.classString(t)),this._warn(r)}return this._then(e,t,n,void 0,void 0)},n.prototype.done=function(e,t,n){var r=this._then(e,t,n,void 0,void 0);r._setIsFinal()},n.prototype.spread=function(e,t){return this.all()._then(e,t,void 0,h,void 0)},n.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},n.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},n.prototype.all=function(){return new _(this).promise()},n.prototype.error=function(e){return this.caught(u.originatesFromRejection,e)},n.is=function(e){return e instanceof n},n.fromNode=function(e){var t=new n(p),r=E(e)(A(t));return r===k&&t._rejectCallback(r.e,!0,!0),t},n.all=function(e){return new _(e).promise()},n.defer=n.pending=function(){var e=new n(p);return new w(e)},n.cast=function(e){var t=g(e);if(!(t instanceof n)){var r=t;t=new n(p),t._fulfillUnchecked(r)}return t},n.resolve=n.fulfilled=n.cast,n.reject=n.rejected=function(e){var t=new n(p);return t._captureStackTrace(),t._rejectCallback(e,!0),t},n.setScheduler=function(e){if("function"!=typeof e)throw new d("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var t=l._schedule;return l._schedule=e,t},n.prototype._then=function(e,t,r,i,s){var a=void 0!==s,u=a?s:new n(p);a||(u._propagateFrom(this,5),u._captureStackTrace());var c=this._target();c!==this&&(void 0===i&&(i=this._boundTo),a||u._setIsMigrated());var f=c._addCallbacks(e,t,r,u,i,o());return c._isResolved()&&!c._isSettlePromisesQueued()&&l.invoke(c._settlePromiseAtPostResolution,c,f),u},n.prototype._settlePromiseAtPostResolution=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(e)},n.prototype._length=function(){return 131071&this._bitField},n.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},n.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},n.prototype._setLength=function(e){this._bitField=-131072&this._bitField|131071&e},n.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},n.prototype._setRejected=function(){this._bitField=134217728|this._bitField},n.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},n.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},n.prototype._isFinal=function(){return(33554432&this._bitField)>0},n.prototype._cancellable=function(){return(67108864&this._bitField)>0},n.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},n.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},n.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},n.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},n.prototype._isMigrated=function(){return(4194304&this._bitField)>0},n.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[5*e-5+4];return t===c?void 0:void 0===t&&this._isBound()?this._boundValue():t},n.prototype._promiseAt=function(e){return 0===e?this._promise0:this[5*e-5+3]},n.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[5*e-5+0]},n.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[5*e-5+1]},n.prototype._boundValue=function(){var e=this._boundTo;return void 0!==e&&e instanceof n?e.isFulfilled()?e.value():void 0:e},n.prototype._migrateCallbacks=function(e,t){var r=e._fulfillmentHandlerAt(t),o=e._rejectionHandlerAt(t),i=e._progressHandlerAt(t),s=e._promiseAt(t),a=e._receiverAt(t);s instanceof n&&s._setIsMigrated(),void 0===a&&(a=c),this._addCallbacks(r,o,i,s,a,null)},n.prototype._addCallbacks=function(e,t,n,r,o,i){var s=this._length();if(s>=131066&&(s=0,this._setLength(0)),0===s)this._promise0=r,void 0!==o&&(this._receiver0=o),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=null===i?e:i.bind(e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:i.bind(t)),"function"==typeof n&&(this._progressHandler0=null===i?n:i.bind(n));else{var a=5*s-5;this[a+3]=r,this[a+4]=o,"function"==typeof e&&(this[a+0]=null===i?e:i.bind(e)),"function"==typeof t&&(this[a+1]=null===i?t:i.bind(t)),"function"==typeof n&&(this[a+2]=null===i?n:i.bind(n))}return this._setLength(s+1),s},n.prototype._setProxyHandlers=function(e,t){var n=this._length();if(n>=131066&&(n=0,this._setLength(0)),0===n)this._promise0=t,this._receiver0=e;else{var r=5*n-5;this[r+3]=t,this[r+4]=e}this._setLength(n+1)},n.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)},n.prototype._resolveCallback=function(e,t){if(!this._isFollowingOrFulfilledOrRejected()){if(e===this)return this._rejectCallback(i(),!1,!0);var r=g(e,this);if(!(r instanceof n))return this._fulfill(e);var o=1|(t?4:0);this._propagateFrom(r,o);var s=r._target();if(s._isPending()){for(var a=this._length(),u=0;a>u;++u)s._migrateCallbacks(this,u);this._setFollowing(),this._setLength(0),this._setFollowee(s)}else s._isFulfilled()?this._fulfillUnchecked(s._value()):this._rejectUnchecked(s._reason(),s._getCarriedStackTrace())}},n.prototype._rejectCallback=function(e,t,n){n||u.markAsOriginatingFromRejection(e);var r=u.ensureErrorObject(e),o=r===e;this._attachExtraTrace(r,t?o:!1),this._reject(e,o?void 0:r)},n.prototype._resolveFromResolver=function(e){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=E(e)(function(e){null!==t&&(t._resolveCallback(e),t=null)},function(e){null!==t&&(t._rejectCallback(e,n),t=null)});n=!1,this._popContext(),void 0!==r&&r===k&&null!==t&&(t._rejectCallback(r.e,!0,!0),t=null)},n.prototype._settlePromiseFromHandler=function(e,t,n,r){if(!r._isRejected()){r._pushContext();var o;if(o=t!==h||this._isRejected()?E(e).call(t,n):E(e).apply(this._boundValue(),n),r._popContext(),o===k||o===r||o===v){var s=o===r?i():o.e;r._rejectCallback(s,!1,!0)}else r._resolveCallback(o)}},n.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},n.prototype._followee=function(){return this._rejectionHandler0},n.prototype._setFollowee=function(e){this._rejectionHandler0=e},n.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},n.prototype._propagateFrom=function(e,t){(1&t)>0&&e._cancellable()&&(this._setCancellable(),this._cancellationParent=e),(4&t)>0&&e._isBound()&&this._setBoundTo(e._boundTo)},n.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},n.prototype._reject=function(e,t){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,t)},n.prototype._settlePromiseAt=function(e){var t=this._promiseAt(e),r=t instanceof n;if(r&&t._isMigrated())return t._unsetIsMigrated(),l.invoke(this._settlePromiseAt,this,e);var o=this._isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e),i=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,s=this._settledValue,a=this._receiverAt(e);this._clearCallbackDataAtIndex(e),"function"==typeof o?r?this._settlePromiseFromHandler(o,a,s,t):o.call(a,s,t):a instanceof _?a._isResolved()||(this._isFulfilled()?a._promiseFulfilled(s,t):a._promiseRejected(s,t)):r&&(this._isFulfilled()?t._fulfill(s):t._reject(s,i)),e>=4&&4===(31&e)&&l.invokeLater(this._setLength,this,0)},n.prototype._clearCallbackDataAtIndex=function(e){if(0===e)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var t=5*e-5;this[t+3]=this[t+4]=this[t+0]=this[t+1]=this[t+2]=void 0}},n.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},n.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},n.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},n.prototype._queueSettlePromises=function(){l.settlePromises(this),this._setSettlePromisesQueued()},n.prototype._fulfillUnchecked=function(e){if(e===this){var t=i();return this._attachExtraTrace(t),this._rejectUnchecked(t,void 0)}this._setFulfilled(),this._settledValue=e,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},n.prototype._rejectUncheckedCheckError=function(e){var t=u.ensureErrorObject(e);this._rejectUnchecked(e,t===e?void 0:t)},n.prototype._rejectUnchecked=function(e,t){if(e===this){var n=i();return this._attachExtraTrace(n),this._rejectUnchecked(n)}return this._setRejected(),this._settledValue=e,this._cleanValues(),this._isFinal()?void l.throwLater(function(e){throw"stack"in e&&l.invokeFirst(m.unhandledRejection,void 0,e),e},void 0===t?e:t):(void 0!==t&&t!==e&&this._setCarriedStackTrace(t),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},n.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var e=this._length(),t=0;e>t;t++)this._settlePromiseAt(t)},u.notEnumerableProp(n,"_makeSelfResolutionError",i),e("./progress.js")(n,_),e("./method.js")(n,p,g,a),e("./bind.js")(n,p,g),e("./finally.js")(n,v,g),e("./direct_resolve.js")(n),e("./synchronous_inspection.js")(n),e("./join.js")(n,_,g,p),n.Promise=n,e("./map.js")(n,_,a,g,p),e("./cancel.js")(n),e("./using.js")(n,a,g,b),e("./generators.js")(n,a,p,g),e("./nodeify.js")(n),e("./call_get.js")(n),e("./props.js")(n,_,g,a),e("./race.js")(n,p,g,a),e("./reduce.js")(n,_,a,g,p),e("./settle.js")(n,_),e("./some.js")(n,_,a),e("./promisify.js")(n,p),e("./any.js")(n),e("./each.js")(n,p),e("./timers.js")(n,p),e("./filter.js")(n,p),u.toFastProperties(n),u.toFastProperties(n.prototype),r({a:1}),r({b:2}),r({c:3}),r(1),r(function(){}),r(void 0),r(!1),r(new n(p)),m.setBounds(l.firstLineError,u.lastLineError),n}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){function i(e){switch(e){case-2:return[];case-3:return{}}}function s(e){var r,o=this._promise=new t(n);e instanceof t&&(r=e,o._propagateFrom(r,5)),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var a=e("./util.js"),u=a.isArray;return s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function c(e,n){var s=r(this._values,this._promise);if(s instanceof t){if(s=s._target(),this._values=s,!s._isFulfilled())return s._isPending()?void s._then(c,this._reject,void 0,this,n):void this._reject(s._reason());if(s=s._value(),!u(s)){var a=new t.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(a)}}else if(!u(s))return void this._promise._reject(o("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());if(0===s.length)return void(-5===n?this._resolveEmptyArray():this._resolve(i(n)));var l=this.getActualLength(s.length);this._length=l,this._values=this.shouldCopyValues()?new Array(l):this._values;for(var f=this._promise,d=0;l>d;++d){var p=this._isResolved(),h=r(s[d],f);h instanceof t?(h=h._target(),p?h._ignoreRejections():h._isPending()?h._proxyPromiseArray(this,d):h._isFulfilled()?this._promiseFulfilled(h._value(),d):this._promiseRejected(h._reason(),d)):p||this._promiseFulfilled(h,d)}},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype.__hardReject__=s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1,!0)},s.prototype._promiseProgressed=function(e,t){this._promise._progress({index:t,value:e})},s.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)},s.prototype._promiseRejected=function(e,t){this._totalResolved++,this._reject(e)},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util.js":38}],25:[function(e,t,n){"use strict";function r(e){return e instanceof Error&&p.getPrototypeOf(e)===Error.prototype}function o(e){var t;if(r(e)){t=new f(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=p.keys(e),o=0;o<n.length;++o){var i=n[o];h.test(i)||(t[i]=e[i])}return t}return a.markAsOriginatingFromRejection(e),e}function i(e){return function(t,n){if(null!==e){if(t){var r=o(u(t));e._attachExtraTrace(r),e._reject(r)}else if(arguments.length>2){for(var i=arguments.length,s=new Array(i-1),a=1;i>a;++a)s[a-1]=arguments[a];e._fulfill(s)}else e._fulfill(n);e=null}}}var s,a=e("./util.js"),u=a.maybeWrapAsError,c=e("./errors.js"),l=c.TimeoutError,f=c.OperationalError,d=a.haveGetters,p=e("./es5.js"),h=/^(?:name|message|stack|cause)$/;if(s=d?function(e){this.promise=e}:function(e){this.promise=e,this.asCallback=i(e),this.callback=this.asCallback},d){var v={get:function(){return i(this.promise)}};p.defineProperty(s.prototype,"asCallback",v),p.defineProperty(s.prototype,"callback",v)}s._nodebackForPromise=i,s.prototype.toString=function(){return"[object PromiseResolver]"},s.prototype.resolve=s.prototype.fulfill=function(e){if(!(this instanceof s))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(e)},s.prototype.reject=function(e){if(!(this instanceof s))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(e)},s.prototype.progress=function(e){if(!(this instanceof s))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(e)},s.prototype.cancel=function(e){this.promise.cancel(e)},s.prototype.timeout=function(){this.reject(new l("timeout"))},s.prototype.isResolved=function(){return this.promise.isResolved()},s.prototype.toJSON=function(){return this.promise.toJSON()},t.exports=s},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!w.test(e)}function o(e){try{return e.__isPromisified__===!0}catch(t){return!1}}function i(e,t,n){var r=p.getDataPropertyOrDefault(e,t+n,b);return r?o(r):!1}function s(e,t,n){for(var r=0;r<e.length;r+=2){var o=e[r];if(n.test(o))for(var i=o.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===i)throw new m("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",t))}}function a(e,t,n,r){for(var a=p.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var l=a[c],f=e[l],d=r===A?!0:A(l,f,e);"function"!=typeof f||o(f)||i(e,l,t)||!r(l,f,e,d)||u.push(l,f)}return s(u,t,n),u}function u(e,r,o,i){function s(){var o=r;r===d&&(o=this);var i=new t(n);i._captureStackTrace();var s="string"==typeof u&&this!==a?this[u]:e,c=h(i);try{s.apply(o,v(arguments,c))}catch(l){i._rejectCallback(g(l),!0,!0)}return i}var a=function(){return this}(),u=e;return"string"==typeof u&&(e=i),p.notEnumerableProp(s,"__isPromisified__",!0),s}function c(e,t,n,r){for(var o=new RegExp(k(t)+"$"),i=a(e,t,o,n),s=0,u=i.length;u>s;s+=2){var c=i[s],l=i[s+1],f=c+t;if(r===E)e[f]=E(c,d,c,l,t);else{var h=r(l,function(){return E(c,d,c,l,t)});p.notEnumerableProp(h,"__isPromisified__",!0),e[f]=h}}return p.toFastProperties(e),e}function l(e,t){return E(e,t,void 0,e)}var f,d={},p=e("./util.js"),h=e("./promise_resolver.js")._nodebackForPromise,v=p.withAppended,g=p.maybeWrapAsError,_=p.canEvaluate,m=e("./errors").TypeError,y="Async",b={__isPromisified__:!0},j=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],w=new RegExp("^(?:"+j.join("|")+")$"),A=function(e){return p.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},k=function(e){return e.replace(/([$])/,"\\$")},E=_?f:u;t.promisify=function(e,t){if("function"!=typeof e)throw new m("fn must be a function\n\n    See http://goo.gl/916lJJ\n");if(o(e))return e;var n=l(e,arguments.length<2?d:t);return p.copyDescriptors(e,n,r),n},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new m("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");t=Object(t);var n=t.suffix;"string"!=typeof n&&(n=y);var r=t.filter;"function"!=typeof r&&(r=A);var o=t.promisifier;if("function"!=typeof o&&(o=E),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var i=p.inheritedDataKeys(e),s=0;s<i.length;++s){var a=e[i[s]];"constructor"!==i[s]&&p.isClass(a)&&(c(a.prototype,n,r,o),c(a,n,r,o))}return c(e,n,r,o)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){function i(e){for(var t=c.keys(e),n=t.length,r=new Array(2*n),o=0;n>o;++o){var i=t[o];r[o]=e[i],r[o+n]=i}this.constructor$(r)}function s(e){var n,s=r(e);return u(s)?(n=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new i(s).promise(),s instanceof t&&n._propagateFrom(s,4),n):o("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var a=e("./util.js"),u=a.isObject,c=e("./es5.js");a.inherits(i,n),i.prototype._init=function(){this._init$(void 0,-3)},i.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var n=++this._totalResolved;if(n>=this._length){for(var r={},o=this.length(),i=0,s=this.length();s>i;++i)r[this._values[i+o]]=this._values[i];this._resolve(r)}},i.prototype._promiseProgressed=function(e,t){this._promise._progress({key:this._values[t+this.length()],value:e})},i.prototype.shouldCopyValues=function(){return!1},i.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5.js":14,"./util.js":38}],28:[function(e,t,n){"use strict";function r(e,t,n,r,o){for(var i=0;o>i;++i)n[i+r]=e[i+t],e[i+t]=void 0}function o(e){this._capacity=e,this._length=0,this._front=0}o.prototype._willBeOverCapacity=function(e){return this._capacity<e},o.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var n=this._front+t&this._capacity-1;this[n]=e,this._length=t+1},o.prototype._unshiftOne=function(e){var t=this._capacity;this._checkCapacity(this.length()+1);var n=this._front,r=(n-1&t-1^t)-t;this[r]=e,this._front=r,this._length=this.length()+1},o.prototype.unshift=function(e,t,n){this._unshiftOne(n),this._unshiftOne(t),this._unshiftOne(e)},o.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var o=this._front+r-3;this._checkCapacity(r);var i=this._capacity-1;this[o+0&i]=e,this[o+1&i]=t,this[o+2&i]=n,this._length=r},o.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},o.prototype.length=function(){return this._length},o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length,i=n+o&t-1;r(this,0,this,t,i)},t.exports=o},{}],29:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){function i(e,i){var u=r(e);if(u instanceof t)return a(u);if(!s(e))return o("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var c=new t(n);void 0!==i&&c._propagateFrom(i,5);for(var l=c._fulfill,f=c._reject,d=0,p=e.length;p>d;++d){var h=e[d];(void 0!==h||d in e)&&t.cast(h)._then(l,f,void 0,c,null)}return c}var s=e("./util.js").isArray,a=function(e){return e.then(function(t){return i(t,e)})};t.race=function(e){return i(e,void 0)},t.prototype.race=function(){return i(this,void 0)}}},{"./util.js":38}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r,o,i){function s(e,n,r,s){this.constructor$(e),this._promise._captureStackTrace(),this._preservedValues=s===i?[]:null,this._zerothIsAccum=void 0===r,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var u=o(r,this._promise),f=!1,d=u instanceof t;d&&(u=u._target(),u._isPending()?u._proxyPromiseArray(this,-1):u._isFulfilled()?(r=u._value(),this._gotAccum=!0):(this._reject(u._reason()),f=!0)),d||this._zerothIsAccum||(this._gotAccum=!0);var p=c();this._callback=null===p?n:p.bind(n),this._accum=r,f||l.invoke(a,this,void 0)}function a(){this._init$(void 0,-5)}function u(e,t,n,o){if("function"!=typeof t)return r("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var i=new s(e,t,n,o);return i.promise()}var c=t._getDomain,l=e("./async.js"),f=e("./util.js"),d=f.tryCatch,p=f.errorObj;f.inherits(s,n),s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},s.prototype._promiseFulfilled=function(e,n){var r=this._values;r[n]=e;var i,s=this.length(),a=this._preservedValues,u=null!==a,c=this._gotAccum,l=this._valuesPhase;if(!l)for(l=this._valuesPhase=new Array(s),i=0;s>i;++i)l[i]=0;if(i=l[n],0===n&&this._zerothIsAccum?(this._accum=e,this._gotAccum=c=!0,l[n]=0===i?1:2):-1===n?(this._accum=e,this._gotAccum=c=!0):0===i?l[n]=1:(l[n]=2,this._accum=e),c){for(var f,h=this._callback,v=this._promise._boundValue(),g=this._reducingIndex;s>g;++g)if(i=l[g],2!==i){if(1!==i)return;if(e=r[g],this._promise._pushContext(),u?(a.push(e),f=d(h).call(v,e,g,s)):f=d(h).call(v,this._accum,e,g,s),this._promise._popContext(),f===p)return this._reject(f.e);var _=o(f,this._promise);if(_ instanceof t){if(_=_._target(),_._isPending())return l[g]=4,_._proxyPromiseArray(this,g);if(!_._isFulfilled())return this._reject(_._reason());f=_._value()}this._reducingIndex=g+1,this._accum=f}else this._reducingIndex=g+1;this._resolve(u?a:this._accum)}},t.prototype.reduce=function(e,t){return u(this,e,t,null)},t.reduce=function(e,t,n,r){return u(e,t,n,r)}}},{"./async.js":2,"./util.js":38}],31:[function(e,n,r){"use strict";var i,s=e("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")};if(s.isNode&&"undefined"==typeof MutationObserver){var u=o.setImmediate,c=t.nextTick;i=s.isRecentNode?function(e){u.call(o,e)}:function(e){c.call(t,e)}}else"undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?i="undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:a:(i=function(e){var t=document.createElement("div"),n=new MutationObserver(e);return n.observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}},i.isStatic=!0);n.exports=i},{"./util":38}],32:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){this.constructor$(e)}var o=t.PromiseInspection,i=e("./util.js");i.inherits(r,n),r.prototype._promiseResolved=function(e,t){this._values[e]=t;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)},r.prototype._promiseFulfilled=function(e,t){var n=new o;n._bitField=268435456,n._settledValue=e,this._promiseResolved(t,n)},r.prototype._promiseRejected=function(e,t){var n=new o;n._bitField=134217728,n._settledValue=e,this._promiseResolved(t,n)},t.settle=function(e){return new r(e).promise()},t.prototype.settle=function(){return new r(this).promise()}}},{"./util.js":38}],33:[function(e,t,n){"use strict";t.exports=function(t,n,r){function o(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function i(e,t){if((0|t)!==t||0>t)return r("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var n=new o(e),i=n.promise();return n.setHowMany(t),n.init(),i}var s=e("./util.js"),a=e("./errors.js").RangeError,u=e("./errors.js").AggregateError,c=s.isArray;s.inherits(o,n),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._howMany=e},o.prototype._promiseFulfilled=function(e){this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},o.prototype._promiseRejected=function(e){if(this._addRejected(e),this.howMany()>this._canPossiblyFulfill()){for(var t=new u,n=this.length();n<this._values.length;++n)t.push(this._values[n]);this._reject(t)}},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},o.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return i(e,t)},t.prototype.some=function(e){return i(this,e)},t._SomePromiseArray=o}},{"./errors.js":13,"./util.js":38}],34:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValue=e._settledValue):(this._bitField=0,this._settledValue=void 0)}t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},t.prototype.isFulfilled=e.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},t.prototype.isRejected=e.prototype._isRejected=function(){return(134217728&this._bitField)>0},t.prototype.isPending=e.prototype._isPending=function(){return 0===(402653184&this._bitField)},t.prototype.isResolved=e.prototype._isResolved=function(){return(402653184&this._bitField)>0},e.prototype.isPending=function(){return this._target()._isPending()},e.prototype.isRejected=function(){return this._target()._isRejected()},e.prototype.isFulfilled=function(){return this._target()._isFulfilled()},e.prototype.isResolved=function(){return this._target()._isResolved()},e.prototype._value=function(){return this._settledValue},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},e.prototype.value=function(){var e=this._target();if(!e.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");
return e._settledValue},e.prototype.reason=function(){var e=this._target();if(!e.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return e._unsetRejectionIsUnhandled(),e._settledValue},e.PromiseInspection=t}},{}],35:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r){if(c(e)){if(e instanceof t)return e;if(i(e)){var l=new t(n);return e._then(l._fulfillUnchecked,l._rejectUncheckedCheckError,l._progressUnchecked,l,null),l}var f=a.tryCatch(o)(e);if(f===u){r&&r._pushContext();var l=t.reject(f.e);return r&&r._popContext(),l}if("function"==typeof f)return s(e,f,r)}return e}function o(e){return e.then}function i(e){return l.call(e,"_promise0")}function s(e,r,o){function i(e){l&&(l._resolveCallback(e),l=null)}function s(e){l&&(l._rejectCallback(e,d,!0),l=null)}function c(e){l&&"function"==typeof l._progress&&l._progress(e)}var l=new t(n),f=l;o&&o._pushContext(),l._captureStackTrace(),o&&o._popContext();var d=!0,p=a.tryCatch(r).call(e,i,s,c);return d=!1,l&&p===u&&(l._rejectCallback(p.e,!0,!0),l=null),f}var a=e("./util.js"),u=a.errorObj,c=a.isObject,l={}.hasOwnProperty;return r}},{"./util.js":38}],36:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){var t=this;return t instanceof Number&&(t=+t),clearTimeout(t),e}function o(e){var t=this;throw t instanceof Number&&(t=+t),clearTimeout(t),e}var i=e("./util.js"),s=t.TimeoutError,a=function(e,t){if(e.isPending()){var n;!i.isPrimitive(t)&&t instanceof Error?n=t:("string"!=typeof t&&(t="operation timed out"),n=new s(t)),i.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._cancel(n)}},u=function(e){return c(+this).thenReturn(e)},c=t.delay=function(e,r){if(void 0===r){r=e,e=void 0;var o=new t(n);return setTimeout(function(){o._fulfill()},r),o}return r=+r,t.resolve(e)._then(u,null,null,r,void 0)};t.prototype.delay=function(e){return c(this,e)},t.prototype.timeout=function(e,t){e=+e;var n=this.then().cancellable();n._cancellationParent=this;var i=setTimeout(function(){a(n,t)},e);return n._then(r,o,void 0,i,void 0)}}},{"./util.js":38}],37:[function(e,t,n){"use strict";t.exports=function(t,n,r,o){function i(e){for(var n=e.length,r=0;n>r;++r){var o=e[r];if(o.isRejected())return t.reject(o.error());e[r]=o._settledValue}return e}function s(e){setTimeout(function(){throw e},0)}function a(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function u(e,n){function o(){if(i>=u)return c.resolve();var l=a(e[i++]);if(l instanceof t&&l._isDisposable()){try{l=r(l._getDisposer().tryDispose(n),e.promise)}catch(f){return s(f)}if(l instanceof t)return l._then(o,s,null,null,null)}o()}var i=0,u=e.length,c=t.defer();return o(),c.promise}function c(e){var t=new g;return t._settledValue=e,t._bitField=268435456,u(this,t).thenReturn(e)}function l(e){var t=new g;return t._settledValue=e,t._bitField=134217728,u(this,t).thenThrow(e)}function f(e,t,n){this._data=e,this._promise=t,this._context=n}function d(e,t,n){this.constructor$(e,t,n)}function p(e){return f.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}var h=e("./errors.js").TypeError,v=e("./util.js").inherits,g=t.PromiseInspection;f.prototype.data=function(){return this._data},f.prototype.promise=function(){return this._promise},f.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},f.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=null!==t?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},f.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(d,f),d.prototype.doDispose=function(e,t){var n=this.data();return n.call(e,e,t)},t.using=function(){var e=arguments.length;if(2>e)return n("you must pass at least 2 arguments to Promise.using");var o=arguments[e-1];if("function"!=typeof o)return n("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var s,a=!0;2===e&&Array.isArray(arguments[0])?(s=arguments[0],e=s.length,a=!1):(s=arguments,e--);for(var u=new Array(e),d=0;e>d;++d){var h=s[d];if(f.isDisposer(h)){var v=h;h=h.promise(),h._setDisposable(v)}else{var g=r(h);g instanceof t&&(h=g._then(p,null,null,{resources:u,index:d},void 0))}u[d]=h}var _=t.settle(u).then(i).then(function(e){_._pushContext();var t;try{t=a?o.apply(void 0,e):o.call(void 0,e)}finally{_._popContext()}return t})._then(c,l,void 0,u,void 0);return u.promise=_,_},t.prototype._setDisposable=function(e){this._bitField=262144|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(262144&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new d(e,this,o());throw new h}}},{"./errors.js":13,"./util.js":38}],38:[function(e,n,r){"use strict";function o(){try{var e=O;return O=null,e.apply(this,arguments)}catch(t){return x.e=t,x}}function i(e){return O=e,o}function s(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function a(e){return!s(e)}function u(e){return s(e)?new Error(_(e)):e}function c(e,t){var n,r=e.length,o=new Array(r+1);for(n=0;r>n;++n)o[n]=e[n];return o[n]=t,o}function l(e,t,n){if(!A.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function f(e,t,n){if(s(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return A.defineProperty(e,t,r),e}function d(e){throw e}function p(e){try{if("function"==typeof e){var t=A.names(e.prototype),n=A.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),o=P.test(e+"")&&A.names(e).length>0;if(n||r||o)return!0}return!1}catch(i){return!1}}function h(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function v(e){return R.test(e)}function g(e,t,n){for(var r=new Array(e),o=0;e>o;++o)r[o]=t+o+n;return r}function _(e){try{return e+""}catch(t){return"[no string representation]"}}function m(e){try{f(e,"isOperational",!0)}catch(t){}}function y(e){return null==e?!1:e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0}function b(e){return e instanceof Error&&A.propertyIsWritable(e,"stack")}function j(e){return{}.toString.call(e)}function w(e,t,n){for(var r=A.names(e),o=0;o<r.length;++o){var i=r[o];if(n(i))try{A.defineProperty(t,i,A.getDescriptor(e,i))}catch(s){}}}var A=e("./es5.js"),k="undefined"==typeof navigator,E=function(){try{var e={};return A.defineProperty(e,"f",{get:function(){return 3}}),3===e.f}catch(t){return!1}}(),x={e:{}},O,T=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},S=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(A.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],o=Object.create(null);null!=e&&!t(e);){var i;try{i=n(e)}catch(s){return r}for(var a=0;a<i.length;++a){var u=i[a];if(!o[u]){o[u]=!0;var c=Object.getOwnPropertyDescriptor(e,u);null!=c&&null==c.get&&null==c.set&&r.push(u)}}e=A.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var o=[];e:for(var i in n)if(r.call(n,i))o.push(i);else{for(var s=0;s<e.length;++s)if(r.call(e[s],i))continue e;o.push(i)}return o}}(),P=/this\s*\.\s*\S+\s*=/,R=/^[a-z$_][a-z$_0-9]*$/i,C=function(){return"stack"in new Error?function(e){return b(e)?e:new Error(_(e))}:function(e){if(b(e))return e;try{throw new Error(_(e))}catch(t){return t}}}(),F={isClass:p,isIdentifier:v,inheritedDataKeys:S,getDataPropertyOrDefault:l,thrower:d,isArray:A.isArray,haveGetters:E,notEnumerableProp:f,isPrimitive:s,isObject:a,canEvaluate:k,errorObj:x,tryCatch:i,inherits:T,withAppended:c,maybeWrapAsError:u,toFastProperties:h,filledRange:g,toString:_,canAttachTrace:b,ensureErrorObject:C,originatesFromRejection:y,markAsOriginatingFromRejection:m,classString:j,copyDescriptors:w,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:"undefined"!=typeof t&&"[object process]"===j(t).toLowerCase()};F.isRecentNode=F.isNode&&function(){var e=t.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),F.isNode&&F.toFastProperties(t);try{throw new Error}catch(I){F.lastLineError=I}n.exports=F},{"./es5.js":14}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:57}],3:[function(e,t,n){var r,o=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=function(e){"use strict";if(!e||"[object Object]"!==i.call(e)||e.nodeType||e.setInterval)return!1;var t=o.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&o.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var s;for(s in e);return s===r||o.call(e,s)};t.exports=function a(){"use strict";var e,t,n,o,i,u,c=arguments[0],l=1,f=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},l=2):("object"!=typeof c&&"function"!=typeof c||c==r)&&(c={});f>l;++l)if(null!=(e=arguments[l]))for(t in e)n=c[t],o=e[t],c!==o&&(d&&o&&(s(o)||(i=Array.isArray(o)))?(i?(i=!1,u=n&&Array.isArray(n)?n:[]):u=n&&s(n)?n:{},c[t]=a(d,u,o)):o!==r&&(c[t]=o));return c}},{}],4:[function(e,t,n){function r(){try{if("undefined"==typeof localStorage)return!1;if(localStorage.setItem("Storage-Test","1"),"1"!==localStorage.getItem("Storage-Test"))return!1;localStorage.removeItem("Storage-Test")}catch(e){return!1}return!0}"object"==typeof n&&(t.exports=r)},{}],5:[function(e,t,n){var r=t.exports=e("./hoodie"),r=t.exports=function(){function t(i){var s=this;if(!(s instanceof t))throw new Error("usage: new Hoodie(url);");s.baseUrl=i?i.replace(/\/+$/,""):"",s.extend=function(e){e(s,r,o)},o.events(s),s.extend(e("./hoodie/id")),s.extend(e("./hoodie/open")),s.extend(e("./hoodie/request")),s.extend(e("./hoodie/connection")),s.extend(e("./hoodie/store")),s.extend(e("./hoodie/account")),s.extend(e("./hoodie/remote")),s.extend(e("./hoodie/task")),s.account.authenticate().then(function(){return s.remote.connect()})["catch"](function(){}),n(s)}function n(e){for(var t=0;t<i.length;t++)i[t](e,r,o)}var r=e("./lib"),o=e("./utils"),i=[];return t.extend=function(e){i.push(e)},t}();r.extend(function(e){e.email={send:e.task("email").start}})},{"./hoodie":6,"./hoodie/account":9,"./hoodie/connection":10,"./hoodie/id":11,"./hoodie/open":12,"./hoodie/remote":13,"./hoodie/request":14,"./hoodie/store":18,"./hoodie/task":22,"./lib":28,"./utils":43}],6:[function(e,t,n){t.exports=function(){function t(i){var s=this;if(!(s instanceof t))throw new Error("usage: new Hoodie(url);");s.baseUrl=i?i.replace(/\/+$/,""):"",s.extend=function(e){e(s,r,o)},o.events(s),s.extend(e("./hoodie/id")),s.extend(e("./hoodie/open")),s.extend(e("./hoodie/request")),s.extend(e("./hoodie/connection")),s.extend(e("./hoodie/store")),s.extend(e("./hoodie/account")),s.extend(e("./hoodie/remote")),s.extend(e("./hoodie/task")),s.account.authenticate().then(function(){return s.remote.connect()})["catch"](function(){}),n(s)}function n(e){for(var t=0;t<i.length;t++)i[t](e,r,o)}var r=e("./lib"),o=e("./utils"),i=[];return t.extend=function(e){i.push(e)},t}()},{"./hoodie/account":9,"./hoodie/connection":10,"./hoodie/id":11,"./hoodie/open":12,"./hoodie/remote":13,"./hoodie/request":14,"./hoodie/store":18,"./hoodie/task":22,"./lib":28,"./utils":43}],7:[function(e,t,n){(function(t){var r=e("./helpers"),o=e("../../utils"),i=o.generateId,s=o.config,a=o.promise,u=a.reject,c=a.resolve,l=a.rejectWith,f=a.resolveWith;n.authenticate=function(e){var t=e.requests;return e.authenticated===!1?u():e.authenticated===!0?f(e.username):t.signOut&&"pending"===t.signOut.state?t.signOut.then(u):t.signIn&&"pending"===t.signIn.state?e.requests.signIn:n.hasAccount(e)?r.withSingleRequest(e,"authenticate",function(){return n.request(e,"GET","/_session").then(r.handleAuthenticateRequestSuccess.bind(null,e))}):r.sendSignOutRequest(e).then(function(){return e.authenticated=!1,u()})},n.hasValidSession=function(e){return n.hasAccount(e)?e.authenticated===!0:!1},n.hasInvalidSession=function(e){return n.hasAccount(e)?e.authenticated===!1:!1},n.signUp=function(e,t,o){return void 0===o&&(o=""),t?n.hasAnonymousAccount(e)?r.upgradeAnonymousAccount(e,t,o)["catch"](function(n){if("HoodieUnauthorizedError"!==n.name)throw n;return r.removeAnonymousPassword(e),r.sendSignUpRequest(e,t,o).done(function(){r.setUsername(e,t),e.events.trigger("signup",t)})}):n.hasAccount(e)?l("Must sign out first."):r.sendSignUpRequest(e,t,o).done(function(){r.setUsername(e,t),e.events.trigger("signup",t)}):l("Username must be set.")},n.anonymousSignUp=function(e){var t,n;return t=i(10),n=e.hoodie.id(),r.sendSignUpRequest(e,n,t).progress(function(){r.setAnonymousPassword(e,t)}).done(function(){e.events.trigger("signup:anonymous")}).then(function(){return c()})},n.hasAccount=function(e){var t=!!e.username;return t||n.hasAnonymousAccount(e)},n.hasAnonymousAccount=function(e){return!!r.getAnonymousPassword(e)},n.signIn=function(e,t,o,i){var s,a,u=t===e.username;return t||(t=""),o||(o=""),t=t.toLowerCase(),i=i||{},s=i.silent,a=!n.hasAccount(e)||u||i.moveData?r.sendSignInRequest(e,t,o,i):r.pushLocalChanges(e,i).then(function(){return r.sendSignInRequest(e,t,o,i)}),u||a.done(r.disconnect.bind(null,e)),a.done(function(t){i.moveData&&e.events.trigger("movedata"),u||i.moveData||(r.cleanup(e),r.setBearerToken(e,e.newBearerToken)),u?s||e.events.trigger("reauthenticated",t):(r.setUsername(e,t),s||e.events.trigger("signin",t,e.newHoodieId,i))}),a},n.signOut=function(e,t){var o,i,s;return t=t||{},o=t.silent?r.cleanup:r.cleanupAndTriggerSignOut,s=e.username,i=n.hasAccount(e)?t.moveData?r.sendSignOutRequest(e):r.pushLocalChanges(e,t).then(r.disconnect.bind(null,e)).then(r.sendSignOutRequest.bind(null,e)).then(o.bind(null,e)):o(e),i.then(function(){return f(s)})},n.request=function(e,t,n,r){return e.hoodie.request.apply(e.hoodie,[t,n,r||{}])},n.db=function(e){return"user/"+e.hoodie.id()},n.fetch=function(e,t){var o=n.hasAnonymousAccount(e)?e.hoodie.id():e.username;return void 0===t&&(t=o),t?r.withSingleRequest(e,"fetch",function(){return n.request(e,"GET",r.userDocUrl(e,t)).done(function(t){return e.userDoc=t,e.userDoc})}):l({name:"HoodieUnauthorizedError",message:"Not signed in"})},n.changePassword=function(e,t,o){return e.username?(r.disconnect(e),n.fetch(e).then(function(){return e.hoodie.request("POST","/_session",{data:{name:e.userDoc.name,password:t}})}).then(r.sendChangeUsernameAndPasswordRequest(e,t,null,o)).then(function(){return c()}).done(function(){e.events.trigger("changepassword")})):l({name:"HoodieUnauthorizedError",message:"Not signed in"})},n.resetPassword=function(e,t){var o,a,u,c;return(c=s.get("_account.resetPasswordId"))?n.checkPasswordReset(e):(c=""+t+"/"+i(),s.set("_account.resetPasswordId",c),a=""+e.userDocPrefix+":$passwordReset/"+c,o={_id:a,name:"$passwordReset/"+c,type:"user",roles:[],password:c,createdAt:r.now(e),updatedAt:r.now(e)},u={data:JSON.stringify(o),contentType:"application/json"},r.withPreviousRequestsAborted(e,"resetPassword",function(){return n.request(e,"PUT","/_users/"+encodeURIComponent(a),u).done(n.checkPasswordReset.bind(null,e)).then(r.awaitPasswordResetResult.bind(null,e)).done(function(){e.events.trigger("resetpassword")})}))},n.checkPasswordReset=function(e){var o,i,a,u,c,f;return(a=s.get("_account.resetPasswordId"))?(c=a.split("/")[0],f="$passwordReset/"+a,u="/_users/"+encodeURIComponent(e.userDocPrefix+":"+f),o=btoa(f+":"+a),i={headers:{Authorization:"Basic "+o}},r.withSingleRequest(e,"passwordResetStatus",function(){return n.request(e,"GET",u,i).then(r.handlePasswordResetStatusRequestSuccess.bind(null,e),r.handlePasswordResetStatusRequestError(e,c)).fail(function(r){return"HoodiePendingError"===r.name?void t.setTimeout(n.checkPasswordReset.bind(null,e),1e3):e.events.trigger("error:passwordreset",r,c)})})):l("No pending password reset.")},n.changeUsername=function(e,t,o){var i=n.hasAnonymousAccount(e)?e.hoodie.id():e.username;return o!==i?(o=o||"",r.changeUsernameAndPassword(e,t,o.toLowerCase()).done(function(){r.setUsername(e,o),e.events.trigger("changeusername",o)})):l({name:"HoodieConflictError",message:"Usernames identical"})},n.destroy=function(e){var t,o=e.username;return t=n.hasAccount(e)?n.fetch(e).then(r.handleFetchBeforeDestroySuccess.bind(null,e),r.handleFetchBeforeDestroyError.bind(null,e)).then(r.cleanupAndTriggerSignOut.bind(null,e)).then(function(){return o}):r.cleanupAndTriggerSignOut(e),t.then(function(){return e.events.trigger("destroy",o),f(o)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":43,"./helpers":8}],8:[function(e,t,n){(function(t){var r=e("extend"),o=e("../../utils"),i=o.config,s=o.promise,a=s.defer,u=s.reject,c=s.rejectWith,l=s.resolveWith,f=s.resolve,d="_account.anonymousPassword";n.setAnonymousPassword=function(e,t){return i.set(d,t)},n.getAnonymousPassword=function(){return i.get(d)},n.removeAnonymousPassword=function(){return i.unset(d)},n.anonymousSignIn=function(e){var t=e.hoodie.id(),r=n.getAnonymousPassword(e);return e.hoodie.account.signIn(t,r).done(function(){e.events.trigger("signin:anonymous",t)})},n.reauthenticate=function(e){return e.authenticated=void 0,e.hoodie.account.authenticate()},n.setUsername=function(e,t){return e.username!==t?(e.username=t,i.set("_account.username",t)):void 0},n.setBearerToken=function(e,t){return e.hoodie.account.bearerToken!==t?(e.hoodie.account.bearerToken=t,i.set("_account.bearerToken",t)):void 0},n.handleAuthenticateRequestSuccess=function(e,t){return t.userCtx.name?(e.authenticated=!0,l(e.username)):e.hoodie.account.hasAnonymousAccount()?n.anonymousSignIn(e):(e.authenticated=!1,e.events.trigger("error:unauthenticated"),u())},n.handleSignUpSuccess=function(e,t,r){return function(o){return e.userDoc._rev=o.rev,n.delayedSignIn(e,t,r)}},n.handleSignUpError=function(e,t){return function(e){return"HoodieConflictError"===e.name&&(e.message="Username "+t+" already exists"),c(e)}},n.delayedSignIn=function(e,r,o,i,s){return s||(s=a()),t.setTimeout(function(){var t=n.sendSignInRequest(e,r,o,i);t.done(s.resolve),t.fail(function(t){"HoodieAccountUnconfirmedError"===t.name?n.delayedSignIn(e,r,o,i,s):s.reject.apply(s,arguments)})},300),s.promise},n.handleSignInSuccess=function(e,t){return t=t||{},function(t){var r,o,i;return r=t.name.replace(/^user(_anonymous)?\//,""),o=t.roles[0],i=t.bearerToken,-1!==t.roles.indexOf("error")?e.hoodie.account.fetch(r).then(function(){return c(e.userDoc.$error)}):-1===t.roles.indexOf("confirmed")?c({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(e.authenticated=!0,e.newHoodieId=o,e.newBearerToken=i,n.setBearerToken(e,i),e.hoodie.account.fetch(r),l(r))}},n.handlePasswordResetStatusRequestSuccess=function(e,t){var n;return t.$error?(n=t.$error,n.object=t,delete n.object.$error):n={name:"HoodiePendingError",message:"Password reset is still pending"},c(n)},n.handlePasswordResetStatusRequestError=function(e,t){return function(n){return"HoodieUnauthorizedError"===n.name?(i.unset("_account.resetPasswordId"),e.events.trigger("passwordreset",t),f()):c(n)}},n.awaitPasswordResetResult=function(e){var t=a();return e.events.one("passwordreset",t.resolve),e.events.on("error:passwordreset",n.removePasswordResetObject.bind(null,e)),e.events.on("error:passwordreset",t.reject),t.promise.always(function(){e.events.removeListener("passwordreset",t.resolve),e.events.removeListener("error:passwordreset",n.removePasswordResetObject.bind(null,e)),e.events.removeListener("error:passwordreset",t.reject)}),t.promise},n.removePasswordResetObject=function(e,t){var n=t.object,r=n.name,o=r.substr(15),s="/_users/"+encodeURIComponent(e.userDocPrefix+":"+r),a=btoa(r+":"+o);n._deleted=!0;var u={headers:{Authorization:"Basic "+a},contentType:"application/json",data:JSON.stringify(n)};e.hoodie.account.request("PUT",s,u),i.unset("_account.resetPasswordId")},n.changeUsernameAndPassword=function(e,t,r,o){var i=e.hoodie.account.hasAnonymousAccount()?e.hoodie.id():e.username;return n.sendSignInRequest(e,i,t).then(function(){return e.hoodie.account.fetch().then(n.sendChangeUsernameAndPasswordRequest(e,t,r,o))})},n.upgradeAnonymousAccount=function(e,t,r){var o=n.getAnonymousPassword(e);return n.changeUsernameAndPassword(e,o,t,r).done(function(){e.events.trigger("signup",t),n.removeAnonymousPassword(e)})},n.handleFetchBeforeDestroySuccess=function(e){return n.disconnect(e),e.userDoc._deleted=!0,n.withPreviousRequestsAborted(e,"updateUsersDoc",function(){e.hoodie.account.request("PUT",n.userDocUrl(e),{data:JSON.stringify(e.userDoc),contentType:"application/json"})})},n.handleFetchBeforeDestroyError=function(e,t){return"HoodieNotFoundError"===t.name?f():c(t)},n.cleanup=function(e){return e.events.trigger("cleanup"),e.authenticated=void 0,n.setUsername(e,void 0),n.setBearerToken(e,void 0),f()},n.disconnect=function(e){return e.hoodie.remote.disconnect()},n.cleanupAndTriggerSignOut=function(e){var t=e.username;return n.cleanup(e).then(function(){return e.events.trigger("signout",t)})},n.userTypeAndId=function(e,t){var n;return n=t===e.hoodie.id()?"user_anonymous":"user",""+n+"/"+t},n.userDocKey=function(e,t){var r=e.hoodie.account.hasAnonymousAccount()?e.hoodie.id():e.username;return t=t||r,""+e.userDocPrefix+":"+n.userTypeAndId(e,t)},n.userDocUrl=function(e,t){return"/_users/"+encodeURIComponent(n.userDocKey(e,t))},n.sendChangeUsernameAndPasswordRequest=function(e,t,o,i){return function(){var s=r({},e.userDoc);o&&(s.$newUsername=o),s.updatedAt=n.now(e),s.signedUpAt=s.signedUpAt||n.now(e),void 0!==i&&(delete s.salt,delete s.password_sha,s.password=i);var a={data:JSON.stringify(s),contentType:"application/json"};return n.withPreviousRequestsAborted(e,"updateUsersDoc",function(){return e.hoodie.account.request("PUT",n.userDocUrl(e),a).then(n.handleChangeUsernameAndPasswordResponse(e,o,i||t))})}},n.handleChangeUsernameAndPasswordResponse=function(e,t,r){var o=e.hoodie.account.hasAnonymousAccount()?e.hoodie.id():e.username;return function(){return n.disconnect(e),t?n.awaitCurrentAccountRemoved(e,o,r).then(function(){return e.hoodie.account.signOut({silent:!0,moveData:!0}).then(function(){return e.hoodie.account.signIn(t,r,{moveData:!0,silent:!0})})}):e.hoodie.account.signIn(o,r,{silent:!0})}},n.awaitCurrentAccountRemoved=function(e,r,o,i){i||(i=a());var s={data:{name:n.userTypeAndId(e,r),password:o}};return n.withPreviousRequestsAborted(e,"signIn",function(){return e.hoodie.account.request("POST","/_session",s)}).done(function(){t.setTimeout(n.awaitCurrentAccountRemoved.bind(null,e),300,r,o,i)}).fail(function(e){return 401===e.status?i.resolve():void i.reject(e)}),i.promise},n.withPreviousRequestsAborted=function(e,t,n){return void 0!==e.requests[t]&&"function"==typeof e.requests[t].abort&&e.requests[t].abort(),e.requests[t]=n(),e.requests[t]},n.withSingleRequest=function(e,t,n){return e.requests[t]&&"pending"===e.requests[t].state?e.requests[t]:(e.requests[t]=n(),e.requests[t].state="pending",e.requests[t].then(function(){e.requests[t].state="fullfiled"},function(){e.requests[t].state="rejected"}),e.requests[t])},n.pushLocalChanges=function(e,t){return e.hoodie.store.hasLocalChanges()&&!t.ignoreLocalChanges?e.hoodie.remote.push():f()},n.sendSignOutRequest=function(e){return n.withSingleRequest(e,"signOut",function(){return e.hoodie.account.request("DELETE","/_session")})},n.sendSignInRequest=function(e,t,r,o){var i={data:{name:n.userTypeAndId(e,t),password:r}};return n.withPreviousRequestsAborted(e,"signIn",function(){var t=e.hoodie.account.request("POST","/_session",i);return t.then(n.handleSignInSuccess(e,o))})},n.sendSignUpRequest=function(e,t,r){var o,i=a();return t=t.toLowerCase(),o={data:JSON.stringify({_id:n.userDocKey(e,t),name:n.userTypeAndId(e,t),type:"user",roles:[],password:r,hoodieId:e.hoodie.id(),database:e.hoodie.account.db(),updatedAt:n.now(e),createdAt:n.now(e),signedUpAt:t!==e.hoodie.id()?n.now(e):void 0}),contentType:"application/json"},e.hoodie.account.request("PUT",n.userDocUrl(e,t),o).done(i.notify).then(n.handleSignUpSuccess(e,t,r),n.handleSignUpError(e,t)).then(i.resolve,i.reject),i.promise},n.now=function(){return new Date}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":43,extend:3}],9:[function(e,t,n){var r=e("../../utils"),o=e("./api"),i=e("./helpers");t.exports=function(e){var t={},n=r.config.get("_account.username"),s={authenticated:null,events:r.events(e,t,"account"),hoodie:e,requests:{},userDoc:{},userDocPrefix:"org.couchdb.user",get username(){return n},set username(e){n=e,t.username=e}};Object.keys(o).forEach(function(e){"function"==typeof o[e]&&(t[e]=o[e].bind(null,s))}),e.on("remote:error:unauthenticated",i.reauthenticate.bind(null,s)),t.on("cleanup",r.config.clear),t.checkPasswordReset()["catch"](function(){}),t.username=n,t.bearerToken=r.config.get("_account.bearerToken"),e.account=t}},{"../../utils":43,"./api":7,"./helpers":8}],10:[function(e,t,n){(function(n){function r(e){i.checkConnection(e)["catch"](function(){})}var o=e("../utils/promise"),i=t.exports=function(e){var t={online:!0,checkConnectionRequest:null,checkConnectionTimeout:null,hoodie:e};e.checkConnection=i.checkConnection.bind(null,t),e.isConnected=i.isConnected.bind(null,t),n.addEventListener("online",r.bind(null,t),!1),n.addEventListener("offline",r.bind(null,t),!1),setTimeout(r.bind(null,t))};i.checkConnection=function(e){if(e.checkConnectionRequest)return e.checkConnectionRequest;var t="/?hoodieId="+e.hoodie.id();return n.clearTimeout(e.checkConnectionTimeout),e.checkConnectionRequest=e.hoodie.request("GET",t).done(i.handleConnection.bind(null,e,3e4,"reconnected",!0)).fail(i.handleConnection.bind(null,e,3e3,"disconnected",!1)),e.checkConnectionRequest.then(function(){})},i.isConnected=function(e){return e&&e.online},i.handleConnection=function(e,t,s,a){return e.checkConnectionRequest=void 0,e.checkConnectionTimeout=n.setTimeout(r.bind(null,e),t),i.isConnected(e)!==a&&(e.hoodie.trigger(s),e.online=a),o[a?"resolve":"reject"]()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/promise":45}],11:[function(e,t,n){var r=e("../utils"),o=r.generateId,i=r.config,n=t.exports=function(e){var t={id:i.get("_hoodieId")};e.on("account:cleanup",n.unsetId.bind(null,t)),e.on("account:signin",function(e,r){n.setId(t,r)}),e.on("account:signin:anonymous",n.setId.bind(null,t)),e.id=n.id.bind(null,t)};n.id=function(e){return e.id||n.setId(e,o()),e.id},n.setId=function(e,t){e.id=t,i.set("_hoodieId",e.id)},n.unsetId=function(e){delete e.id,i.unset("_hoodieId")}},{"../utils":43}],12:[function(e,t,n){var r=e("../lib/store/remote"),o=e("extend"),n=t.exports=function(e){e.open=n.open.bind(null,e)};n.open=function(e,t,r){return r=r||{},o(r,{name:t}),n.hoodieRemoteStore(e,r)},n.hoodieRemoteStore=r},{"../lib/store/remote":35,extend:3}],13:[function(e,t,n){var r=e("../utils"),o=r.config,i=r.promise.rejectWith,n=t.exports=function(e){function t(){}function r(e){s.push(e)["catch"](t)}function o(e){s.connect(e)["catch"](t)}function i(){s.disconnect()["catch"](t)}var s=e.open(e.account.db(),{connected:!0,prefix:"",since:n.sinceNrCallback,defaultObjectsToPush:e.store.changedObjects,knownObjects:e.store.index().map(function(e){var t=e.split(/\//);return{type:t[0],id:t[1]}})});s.connect=n.connect.bind(null,e,s.connect),s.trigger=n.trigger.bind(null,e),s.on=n.on.bind(null,e),s.unbind=n.unbind.bind(null,e),e.on("remote:connect",function(){e.on("store:idle",r)}),e.on("remote:disconnect",function(){e.unbind("store:idle",r)}),e.on("disconnected",i),e.on("reconnected",o),e.on("account:signup",o),e.on("account:signup:anonymous",o),e.on("account:signin",o),e.on("account:signin:anonymous",o),e.on("account:changeusername",o),e.on("account:reauthenticated",o),e.on("account:signout",i),e.remote=s};n.connect=function(e,t){return e.account.hasAccount()?t(e.account.db()):i("User has no database to connect to")},n.trigger=function(e){var t=Array.prototype.slice.call(arguments,1);return t[0]="remote:"+t[0],e.trigger.apply(e,t)},n.on=function(e,t,n){return t=t.replace(/(^| )([^ ]+)/g,"$1remote:$2"),e.on(t,n)},n.unbind=function(e,t,n){return t=t.replace(/(^| )([^ ]+)/g,"$1remote:$2"),e.unbind(t,n)},n.sinceNrCallback=function(e){return e?o.set("_remote.since",e):o.get("_remote.since")||0}},{"../utils":43}],14:[function(e,t,n){(function(n){var r=e("extend"),o=e("../utils"),i=o.hoodiefyRequestErrorName,s=o.promise.defer,a=o.promise.rejectWith,u=t.exports=function(e){e.request=u.request.bind(null,e)},c="/_api";u.request=function(e,t,o,i){var a,l={type:t,dataType:"json"},f=s(),d=f.promise;i=i||{},e.account.bearerToken&&(l.headers={Authorization:"Bearer "+e.account.bearerToken}),/^http/.test(o)||(o=(e.baseUrl||"")+c+o),/^http/.test(o)&&(l.xhrFields={withCredentials:!0},l.crossDomain=!0),l.url=o,a=n.jQuery.ajax(r(l,i)).done(f.resolve).fail(f.reject);var p=d["catch"](u.handleRequestError.bind(null,e));return p.abort=a.abort,p},u.handleRequestError=function(e,t){var n;if("abort"===t.statusText)return a({name:"HoodieConnectionAbortError",message:"Request has been aborted"});try{n=u.parseErrorFromResponse(t)}catch(r){n=t&&t.responseText?t.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:e.baseUrl||"/"}}return a(n)},u.HTTP_STATUS_ERROR_MAP={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"},u.parseErrorFromResponse=function(e){var t=JSON.parse(e.responseText);return t.name=u.HTTP_STATUS_ERROR_MAP[e.status],t.name||(t.name=i(t.error)),t.status=e.status,t.message=t.reason||"",t.message=t.message.charAt(0).toUpperCase()+t.message.slice(1),delete t.error,delete t.reason,t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils":43,extend:3}],15:[function(e,t,n){(function(n){var r=e("../../utils"),o=r.promise,i=o.defer,s=r.localStorageWrapper,a=e("./helpers"),u=t.exports;u.index=function(e){var t,n,r,o,i;for(r=[],t=o=0,i=s.length;i>=0?i>o:o>i;t=i>=0?++o:--o)n=s.key(t),a.isSemanticKey(e,n)&&r.push(n);return r},u.changedObjects=function(e){var t,n,r,o,i,s,a;i=e.dirty,a=[];for(n in i)i.hasOwnProperty(n)&&(r=i[n],s=n.split("/"),o=s[0],t=s[1],r.type=o,r.id=t,a.push(r));return a},u.hasLocalChanges=function(e,t,r){if(!t)return!n.$.isEmptyObject(e.dirty);var o=[t,r].join("/");return e.dirty[o]?!0:a.hasLocalChanges(e,a.cache(e,t,r))},u.clear=function(e){var t,n,r,o;t=i();try{r=u.index(e),o=function(){var t,o,i;for(i=[],t=0,o=r.length;o>t;t++)n=r[t],a.isSemanticKey(e,n)&&i.push(s.removeItem(n));return i}.call(this),e.cachedObject={},a.clearChanged(e),t.resolve(),e.hoodie.store.trigger("clear")}catch(c){t.reject(c)}return t.promise},u.isBootstrapping=function(e){return e.bootstrapping},u.isPersistent=function(){return s.isPersistent}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":43,"./helpers":17}],16:[function(e,t,n){var r=e("./localstore"),n=t.exports;n.start=function(e){e.bootstrapping=!0,
e.hoodie.store.trigger("bootstrap:start")},n.end=function(e){var t,n,o,i;for(e.bootstrapping=!1;e.queue.length>0;)t=e.queue.shift(),n=t[0],o=t[1],i=t[2],r[n].bind(r).apply(r,o).then(i.resolve,i.reject);e.hoodie.store.trigger("bootstrap:end")},n.abort=function(e,t){var n,r;for(e.bootstrapping=!1;e.queue.length>0;)n=e.queue.shift(),r=n[2],r.reject(t);e.hoodie.store.trigger("bootstrap:error",t)}},{"./localstore":19}],17:[function(e,t,n){(function(n){var r=e("extend"),o=e("../../utils"),i=o.promise,s=i.defer,a=o.localStorageWrapper,u=t.exports;u.cache=function(e,t,n,o,i){var s,c;if(void 0===o&&(o=!1),i=i||{},s=""+t+"/"+n,o){if(r(o,{type:t,id:n}),c=r({},o),delete c.type,delete c.id,a.setObject(s,c),i.remote)return u.clearChanged(e,t,n),e.cachedObject[s]=r(!0,{},o),e.cachedObject[s]}else{if(e.cachedObject[s]===!1)return!1;if(e.cachedObject[s])return r(!0,{},e.cachedObject[s]);if(s=""+t+"/"+n,o=a.getObject(s),!o)return u.clearChanged(e,t,n),e.cachedObject[s]=!1,!1;o.type=t,o.id=n}return u.isMarkedAsDeleted(e,o)?(u.markAsChanged(e,t,n,o,i),e.cachedObject[s]=!1,!1):(e.cachedObject[s]=r(!0,{},o),u.hasLocalChanges(e,o)?u.markAsChanged(e,t,n,e.cachedObject[s],i):u.clearChanged(e,t,n),r(!0,{},o))},u.markAsChanged=function(e,t,n,r,o){var i;o=o||{},i=""+t+"/"+n,e.dirty[i]=r,u.saveDirtyIds(e),o.silent||u.triggerDirtyAndIdleEvents(e)},u.clearChanged=function(e,t,r){var o;return t&&r?(o=""+t+"/"+r,delete e.dirty[o]):e.dirty={},u.saveDirtyIds(e),n.clearTimeout(e.dirtyTimeout)},u.markAllAsChanged=function(e){return e.hoodie.store.findAll().done(function(t){var n,r,o,i;for(o=0,i=t.length;i>o;o++)r=t[o],n=""+r.type+"/"+r.id,e.dirty[n]=r;u.saveDirtyIds(e),u.triggerDirtyAndIdleEvents(e)})},u.handleRemoteChange=function(e,t,n){var r;"_design"!==n.type&&(r="remove"===t?e.hoodie.store.remove(n.type,n.id,{remote:!0,update:n}):e.hoodie.store.save(n.type,n.id,n,{remote:!0}),r["catch"](function(){}))},u.handlePushedObject=function(e,t){var n;u.triggerEvents(e,"sync",t),n=t._deleted?e.hoodie.store.remove(t.type,t.id,{remote:!0,silent:!0}):e.hoodie.store.save(t.type,t.id,t,{remote:!0,silent:!0}),n["catch"](function(){})},u.saveDirtyIds=function(e){if(n.$.isEmptyObject(e.dirty))a.removeItem("_dirty");else{var t=Object.keys(e.dirty);a.setItem("_dirty",t.join(","))}},u.now=function(){return JSON.stringify(new Date).replace(/['"]/g,"")},u.SEMANTIC_ID_PATTERN=new RegExp(/^[a-z$][a-z0-9-]+\/[a-z0-9]+$/),u.isSemanticKey=function(e,t){return u.SEMANTIC_ID_PATTERN.test(t)},u.hasLocalChanges=function(e,t){return t.updatedAt?t._syncedAt?t._syncedAt<t.updatedAt:!0:!1},u.isMarkedAsDeleted=function(e,t){return t._deleted===!0},u.triggerEvents=function(e,t,n,o){e.hoodie.store.trigger(t,r(!0,{},n),o),e.hoodie.store.trigger(n.type+":"+t,r(!0,{},n),o),"new"!==t&&e.hoodie.store.trigger(n.type+":"+n.id+":"+t,r(!0,{},n),o),"sync"!==t&&(e.hoodie.store.trigger("change",t,r(!0,{},n),o),e.hoodie.store.trigger(n.type+":change",t,r(!0,{},n),o),"new"!==t&&e.hoodie.store.trigger(n.type+":"+n.id+":change",t,r(!0,{},n),o))},u.triggerDirtyAndIdleEvents=function(e){e.hoodie.store.trigger("dirty"),n.clearTimeout(e.dirtyTimeout),e.dirtyTimeout=n.setTimeout(function(){e.hoodie.store.trigger("idle",e.hoodie.store.changedObjects())},e.idleTimeout)},u.enqueue=function(e,t,n){var r=s();return e.queue.push([t,n,r]),r.promise},u.moveData=function(e){var t,n=[];e.hoodie.store.findAll().done(function(r){n=r,n.length&&(t=e.hoodie.id(),e.hoodie.once("account:signin",function(r,o){n.forEach(function(n){n.createdBy===t&&(n.createdBy=o),n=u.cache(e,n.type,n.id,n),u.markAsChanged(e,n.type,n.id,n,{silent:!0})}),u.triggerDirtyAndIdleEvents(e)}))})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":43,extend:3}],18:[function(e,t,n){var r=e("../../lib/store/api"),o=e("../../lib/error/object_type"),i=e("../../lib/error/object_id"),s=e("./api"),a=e("./bootstrap"),u=e("./helpers"),c=e("./localstore"),l=e("../../utils").localStorageWrapper,n=t.exports=function(e){var t={bootstrapping:!1,cachedObject:{},dirtyTimeout:void 0,dirty:{},hoodie:e,queue:[],idleTimeout:2e3},r=n.hoodieStoreApi(e,{validate:n.validate,backend:{save:n.localStore.save.bind(null,t),find:n.localStore.find.bind(null,t),findAll:n.localStore.findAll.bind(null,t),remove:n.localStore.remove.bind(null,t),removeAll:n.localStore.removeAll.bind(null,t)}});Object.keys(s).forEach(function(e){"function"==typeof s[e]&&(r[e]=s[e].bind(null,t))}),e.on("account:signup",u.markAllAsChanged.bind(null,t)),e.on("account:movedata",u.moveData.bind(null,t)),e.on("account:cleanup",s.clear.bind(null,t)),e.on("remote:bootstrap:start",a.start.bind(null,t)),e.on("remote:bootstrap:end",a.end.bind(null,t)),e.on("remote:bootstrap:error",a.abort.bind(null,t)),e.on("remote:change",u.handleRemoteChange.bind(null,t)),e.on("remote:push",u.handlePushedObject.bind(null,t)),e.store=r,n.bootstrapChangedObjects(t)};n.bootstrapChangedObjects=function(e){var t=l.getItem("_dirty");if(t){t=t.split(",");for(var n=0;n<t.length;n++){var r=t[n].split("/");u.cache(e,r[0],r[1])}}},n.validate=function(e){if(o.isInvalid(e.type))return new o({type:e.type});if(e.id)return i.isInvalid(e.id)?new i({id:e.id}):void 0},n.hoodieStoreApi=r,n.localStore=c},{"../../lib/error/object_id":25,"../../lib/error/object_type":26,"../../lib/store/api":31,"../../utils":43,"./api":15,"./bootstrap":16,"./helpers":17,"./localstore":19}],19:[function(e,t,n){var r=e("./helpers"),o=e("../../utils"),i=o.generateId,s=o.localStorageWrapper,a=o.promise,u=a.defer,c=a.rejectWith,l=a.resolveWith,f=a.Promise;n.save=function(e,t,n){var o,s,a,c,l,f;if(n=n||{},e.hoodie.store.isBootstrapping(e)&&!n.remote)return r.enqueue(e,"save",arguments);if(t.id?(o=r.cache(e,t.type,t.id),l="object"!=typeof o):(l=!0,t.id=i()),l?t.createdBy=t.createdBy||e.hoodie.id():o.createdBy&&(t.createdBy=o.createdBy),!l)for(f in o)if(!t.hasOwnProperty(f))switch(f.charAt(0)){case"_":n.remote&&(t[f]=o[f]);break;case"$":n.remote||(t[f]=o[f])}n.remote?t._syncedAt=r.now(e):n.silent||(t.updatedAt=r.now(e),t.createdAt=t.createdAt||t.updatedAt),n.local?t._$local=!0:delete t._$local,s=u();try{t=r.cache(e,t.type,t.id,t,n),s.resolve(t,l),c=l?"add":"update",n.silent||r.triggerEvents(e,c,t,n)}catch(d){a=d,s.reject(a.toString())}return s.promise},n.find=function(e,t,n){var o,i;if(e.hoodie.store.isBootstrapping())return r.enqueue(e,"find",arguments);try{return i=r.cache(e,t,n),i?l(i):c({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found',type:t,id:n})}catch(s){return o=s,c(o)}},n.findAll=function(e,t){var n,o,i,s,a,c,l,f,d;if(null==t&&(t=function(){return!0}),e.hoodie.store.isBootstrapping())return r.enqueue(e,"findAll",arguments);c=e.hoodie.store.index(),"string"==typeof t&&(d=t,t=function(e){return e.type===d}),o=u();try{f=function(){var o,i,u,f;for(f=[],o=0,i=c.length;i>o;o++)a=c[o],r.isSemanticKey(e,a)&&(u=a.split("/"),n=u[0],s=u[1],l=r.cache(e,n,s),l&&t(l)&&f.push(l));return f}.call(this),f.sort(function(e,t){return e.createdAt>t.createdAt?-1:e.createdAt<t.createdAt?1:0}),o.resolve(f)}catch(p){i=p,o.reject(i)}return o.promise},n.remove=function(e,t,n,o){var i,a,u;return o=o||{},e.hoodie.store.isBootstrapping()&&!o.remote?r.enqueue(e,"remove",arguments):(i=t+"/"+n,a=r.cache(e,t,n),o.update&&(a=o.update,delete o.update),o.remote&&(s.removeItem(i),u=e.cachedObject[i]&&r.isMarkedAsDeleted(e,e.cachedObject[i]),e.cachedObject[i]=!1,r.clearChanged(e,t,n),a)?(u||r.triggerEvents(e,"remove",a,o),l(a)):a?(a._syncedAt?(a._deleted=!0,r.cache(e,t,n,a)):(i=t+"/"+n,s.removeItem(i),e.cachedObject[i]=!1,r.clearChanged(e,t,n)),r.triggerEvents(e,"remove",a,o),l(a)):c({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found',type:t,id:n}))},n.removeAll=function(e,t,n){return e.hoodie.store.findAll(t).then(function(t){var r;return r=t.map(function(t){return e.hoodie.store.remove(t.type,t.id,n)}),f.all(r)})}},{"../../utils":43,"./helpers":17}],20:[function(e,t,n){var r=e("extend"),o=e("./helpers"),i=e("../../utils"),s=i.promise.defer,n=t.exports;n.start=function(e,t,r){var i;return e.hoodie.account.hasAccount()?e.hoodie.store.add("$"+t,r).then(o.handleNewTask.bind(null,e)):(i=s(),e.hoodie.account.anonymousSignUp().then(function(){return n.start(e,t,r).progress(i.notify)}).done(i.resolve).fail(i.reject),i.promise)},n.abort=function(e,t,n){return e.hoodie.store.update("$"+t,n,{abortedAt:o.now(e)}).then(o.handleAbortedTaskObject.bind(null,e))},n.restart=function(e,t,o,i){var s=function(t){return r(t,i),delete t.$error,delete t.$processedAt,delete t.abortedAt,n.start(e,t.type.substr(1),t)};return n.abort(e,t,o).then(s)},n.abortAll=function(e,t){return o.findAll(e,t).then(o.abortTaskObjects.bind(null,e))},n.restartAll=function(e,t,n){return"object"==typeof t&&(n=t),o.findAll(e,t).then(function(t){o.restartTaskObjects(e,t,n)})}},{"../../utils":43,"./helpers":21,extend:3}],21:[function(e,t,n){var r=e("../../lib"),o=r.error.error,i=e("../../utils"),s=i.promise.defer,a=e("extend"),n=t.exports;n.handleNewTask=function(e,t){var n=s(),r=e.hoodie.store(t.type,t.id);return r.on("sync",function(e){e.type=e.type.substr(1),n.notify(e)}),r.on("remove",function(e){return e.type=e.type.substr(1),e.$processedAt?n.resolve(e):void n.reject(new o({message:"Task has been aborted",task:e}))}),r.on("update",function(t){var r=t.$error;t.$error&&(t.type=t.type.substr(1),delete t.$error,r.object=t,r.message=r.message||"Something went wrong",n.reject(new o(r)),e.hoodie.store.remove("$"+t.type,t.id))}),n.promise},n.handleAbortedTaskObject=function(e,t){var n,r=t.type,o=t.id,i=e.hoodie.store.remove(r,o);return t._rev?(n=s(),e.hoodie.once("store:sync:"+r+":"+o,n.resolve),i.fail(n.reject),n.promise):i},n.handleStoreChange=function(e,t,r,o){"$"===r.type[0]&&(r.type=r.type.substr(1),n.triggerEvents(e,t,r,o))},n.findAll=function(e,t){var n,r="$";return t&&(r+=t),n=function(e){return 0===e.type.indexOf(r)},e.hoodie.store.findAll(n)},n.abortTaskObjects=function(e,t){return t.map(function(t){return e.hoodie.task.abort(t.type.substr(1),t.id)})},n.restartTaskObjects=function(e,t,n){return t.map(function(t){return e.hoodie.task.restart(t.type.substr(1),t.id,n)})},n.triggerEvents=function(e,t,n,r){var o;return"add"===t&&(t="start"),"remove"===t&&n.abortedAt&&(t="abort"),"remove"===t&&n.$processedAt&&!n.$error&&(t="success"),"update"===t&&n.$error?(t="error",o=n.$error,delete n.$error,e.events.trigger("error",o,n,r),e.events.trigger(n.type+":error",o,n,r),e.events.trigger(n.type+":"+n.id+":error",o,n,r),r=a({},r,{error:o}),e.events.trigger("change","error",n,r),e.events.trigger(n.type+":change","error",n,r),void e.events.trigger(n.type+":"+n.id+":change","error",n,r)):void(("start"===t||"abort"===t||"success"===t)&&(e.events.trigger(t,n,r),e.events.trigger(n.type+":"+t,n,r),"start"!==t&&e.events.trigger(n.type+":"+n.id+":"+t,n,r),e.events.trigger("change",t,n,r),e.events.trigger(n.type+":change",t,n,r),"start"!==t&&e.events.trigger(n.type+":"+n.id+":change",t,n,r)))},n.now=function(){return JSON.stringify(new Date).replace(/['"]/g,"")}},{"../../lib":28,"../../utils":43,extend:3}],22:[function(e,t,n){var r=e("../../lib"),o=e("../../utils"),i=e("./api"),s=e("./helpers"),n=t.exports=function(e){var t,r=function(){return t.apply(null,arguments)};t=n.scopedTask.bind(null,e,r);var a={events:o.events(e,r,"task"),hoodie:e};Object.keys(i).forEach(function(e){"function"==typeof i[e]&&(r[e]=i[e].bind(null,a))}),e.task=r,e.on("store:change",s.handleStoreChange.bind(null,a))};n.scopedTask=function(e,t,n,o){return r.task.scoped(e,t,{type:n,id:o})}},{"../../lib":28,"../../utils":43,"./api":20,"./helpers":21}],23:[function(e,t,n){var r=e("extend");t.exports=function(){function e(e){"string"==typeof e&&(e={message:e}),e.message||(e.message="Something went wrong"),e.name||(e.name="HoodieError"),e.message=e.message.replace(t,function(t){var r=t.match(n)[0];return e[r]}),r(this,e)}var t=/\{\{\s*\w+\s*\}\}/g,n=/\w+/;return e.prototype=new Error,e.prototype.constructor=e,e}()},{extend:3}],24:[function(e,t,n){t.exports={error:e("./error"),objectId:e("./object_id"),objectType:e("./object_type")}},{"./error":23,"./object_id":25,"./object_type":26}],25:[function(e,t,n){var r=e("./error"),o=e("./validation");t.exports=function(){function e(e){return e.name="HoodieObjectIdError",e.message='"{{id}}" is invalid object id. {{rules}}.',new r(e)}var t=/^[a-z0-9\-]+$/;return e.isValid=o.isValid.bind(null,t),e.isInvalid=o.isInvalid.bind(null,t),e.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",e}()},{"./error":23,"./validation":27}],26:[function(e,t,n){var r=e("./error"),o=e("./validation"),i="lowercase letters, numbers and dashes allowed only. Must start with a letter";t.exports=function(){function e(e){return e.name="HoodieObjectTypeError",e.message='"{{type}}" is invalid object type. {{rules}}.',e.rules=i,new r(e)}var t=/^[a-z$][a-z0-9-]+$/;return e.isValid=o.isValid.bind(null,t),e.isInvalid=o.isInvalid.bind(null,t),e}()},{"./error":23,"./validation":27}],27:[function(e,t,n){n.isValid=function(e,t,n){return(n||e).test(t||"")},n.isInvalid=function(){return!n.isValid.apply(null,arguments)}},{}],28:[function(e,t,n){t.exports={error:e("./error"),store:e("./store"),task:e("./task")}},{"./error":24,"./store":32,"./task":38}],29:[function(e,t,n){var r=e("extend"),o=e("./helpers"),i=e("../../../utils"),s=i.promise,a=s.rejectWith,u=s.resolveWith,c=s.isPromise,l=s.Promise;n.save=function(e,t,n,i,s){s=s?r(!0,{},s):{};var u=r(!0,{},i,{type:t,id:n}),c=e.validate(u,s||{});return c?a(c):o.decoratePromise(e,e.backend.save(u,s||{}))},n.add=function(e,t,r,o){return void 0===r&&(r={}),o=o||{},r.id?n.find(e,t,r.id).then(function(e){return a({name:"HoodieConflictError",message:'"{{type}}" with id "{{id}}" already exists',type:e.type,id:e.id})})["catch"](function(i){if("HoodieNotFoundError"===i.name)return n.save(e,t,r.id,r,o);throw i}):n.save(e,t,r.id,r,o)},n.find=function(e,t,n){return o.decoratePromise(e,e.backend.find(t,n))},n.findOrAdd=function(e,t,i,s){function a(){var o;return o=r(!0,{id:i},s),n.add(e,t,o)}null===s&&(s={});var u=n.find(e,t,i).then(null,a);return o.decoratePromise(e,u)},n.findAll=function(e,t,n){return o.decoratePromise(e,e.backend.findAll(t,n))},n.update=function(e,t,i,s,a){function c(o){var c,l,f;return l=r(!0,{},o),"function"==typeof s&&(s=s(l)),s?(c=function(){var e=[];for(var t in s)if(s.hasOwnProperty(t)){if(f=s[t],o[t]===f)continue;l[t]=f,e.push(t)}return e}(),c.length||a?n.save(e,t,i,l,a):u(l)):u(o)}var l=n.find(e,t,i).then(c);return o.decoratePromise(e,l)},n.updateOrAdd=function(e,t,i,s,a){function u(){var o=r(!0,{},s,{id:i});return n.add(e,t,o,a)}var c=n.update(e,t,i,s,a).then(null,u);return o.decoratePromise(e,c)},n.updateAll=function(e,t,r,i){var s;switch(i=i||{},!0){case"string"==typeof t:s=n.findAll(e,t);break;case c(t):s=t;break;case $.isArray(t):s=u(t);break;default:s=n.findAll(e),i=r,r=t}return s=s.then(function(t){var o;return $.isArray(t)||(t=[t]),o=t.map(function(t){return n.update(e,t.type,t.id,r,i)}),l.all(o)}),o.decoratePromise(e,s)},n.remove=function(e,t,n,r){return o.decoratePromise(e,e.backend.remove(t,n,r||{}))},n.removeAll=function(e,t,n){return o.decoratePromise(e,e.backend.removeAll(t,n||{}))},n.decoratePromises=function(e,t){return r(e.promiseApi,t)}},{"../../../utils":43,"./helpers":30,extend:3}],30:[function(e,t,n){var r=e("extend"),o=e("../../error"),i=o.error,s=o.objectType,a=o.objectId,n=t.exports;n.decoratePromise=function(e,t){return r(t,e.promiseApi)},n.validIdOrTypePattern=/^[^\/]+$/,n.validIdOrTypeRules="/ not allowed",n.defaultValidate=function(e){if(!e)return new i({name:"InvalidObjectError",message:"No object passed."});if(s.isInvalid(e.type,n.validIdOrTypePattern))return new s({type:e.type,rules:n.validIdOrTypeRules});if(e.id)return a.isInvalid(e.id,n.validIdOrTypePattern)?new a({id:e.id,rules:n.validIdOrTypeRules}):void 0}},{"../../error":24,extend:3}],31:[function(e,t,n){var r=e("../scoped"),o=e("extend"),i=e("../../../utils"),s=e("./helpers"),a=e("./api");t.exports=function(e,t){var n={backend:{},hoodie:e,storeName:t.name||"store",promiseApi:{hoodie:e}},u=function(n,i){var s=o(!0,{type:n,id:i},t);return r(e,u,s)};if(n.events=i.events(e,u,n.storeName),u.validate=n.validate=s.defaultValidate.bind(null),"function"==typeof t.validate&&(u.validate=n.validate=t.validate),!t.backend)throw new Error("options.backend must be passed");return["save","find","findAll","remove","removeAll"].forEach(function(e){if(!t.backend[e])throw new Error("options.backend."+e+" must be passed.");n.backend[e]=t.backend[e]}),Object.keys(a).forEach(function(e){"function"==typeof a[e]&&(u[e]=a[e].bind(null,n))}),u}},{"../../../utils":43,"../scoped":37,"./api":29,"./helpers":30,extend:3}],32:[function(e,t,n){t.exports={api:e("./api"),remote:e("./remote"),scoped:e("./scoped")}},{"./api":31,"./remote":35,"./scoped":37}],33:[function(e,t,n){(function(n){var r=e("extend"),o=e("../../../utils"),i=o.promise.defer,s=o.promise.resolveWith,a=o.promise.resolve,u=e("./helpers"),c=t.exports;c.request=function(e,t,n,r){return r=r||{},e.remoteName&&(n="/"+encodeURIComponent(e.remoteName)+n),e.baseUrl&&(n=""+e.baseUrl+n),r.contentType=r.contentType||"application/json",("POST"===t||"PUT"===t)&&(r.dataType=r.dataType||"json",r.processData=r.processData||!1,r.data=JSON.stringify(r.data)),e.hoodie.request(t,n,r)},c.isKnownObject=function(e,t){var n=""+t.type+"/"+t.id;return void 0!==e.knownObjects[n]?e.knownObjects[n]:void 0},c.markAsKnownObject=function(e,t){var n=""+t.type+"/"+t.id;return e.knownObjects[n]=1,e.knownObjects[n]};var l;c.connect=function(e,t){return e.connected?l.promise:(l=i(),t&&(e.remoteName=t),e.connected=!0,e.remote.trigger("connect"),e.remote.bootstrap().then(function(){return e.remote.push()}).then(l.resolve,l.reject),l.promise)},c.disconnect=function(e){return e.connected=!1,e.remote.trigger("disconnect"),e.pullRequest&&e.pullRequest.abort(),e.pushRequest&&e.pushRequest.abort(),l=void 0,a()},c.isConnected=function(e){return e.connected},c.getSinceNr=function(e){return"function"==typeof e.since?e.since():e.since},c.bootstrap=function(e){return e.isBootstrapping=!0,e.remote.trigger("bootstrap:start"),e.remote.pull({forceGzip:!0})["catch"](function(){return e.remote.pull()}).done(u.handleBootstrapSuccess.bind(null,e)).fail(u.handleBootstrapError.bind(null,e))},c.pull=function(e,t){return e.pullRequest=e.remote.request("GET",u.pullUrl(e,t)),e.remote.isConnected()&&(n.clearTimeout(e.pullRequestTimeout),e.pullRequestTimeout=n.setTimeout(u.restartPullRequest.bind(null,e),25e3)),e.pullRequest.done(u.handlePullSuccess.bind(null,e)).fail(u.handlePullError.bind(null,e))},c.push=function(e,t){var n,o=[];if($.isArray(t)||(t=u.defaultObjectsToPush(e)),0===t.length)return s([]);t=t.map(function(e){return r(!0,{},e)}),o=[];for(var i=0;i<t.length;i++)n=t[i],u.addRevisionTo(e,n),e.remote.markAsKnownObject(n),n=u.parseForRemote(e,n),o.push(n),e.pushedObjectRevisions[n._rev]=1;return e.pushRequest=e.remote.request("POST","/_bulk_docs",{data:{docs:o,new_edits:!1}}),e.pushRequest.done(function(){for(var n=0;n<t.length;n++)delete t[n]._revisions,e.remote.trigger("push",t[n])}),e.pushRequest},c.sync=function(e,t){return e.remote.push(t).then(e.remote.pull)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../utils":43,"./helpers":34,extend:3}],34:[function(e,t,n){(function(n){var r=e("extend"),o=e("../../../utils"),i=o.generateId,s=t.exports;s.VALID_SPECIAL_ATTRIBUTES=["_id","_rev","_deleted","_revisions","_attachments"],s.defaultObjectsToPush=function(e){return e.options&&e.options.defaultObjectsToPush?n.$.isArray(e.options.defaultObjectsToPush)?e.options.defaultObjectsToPush:e.options.defaultObjectsToPush():[]},s.setSinceNr=function(e,t){return"function"==typeof e.since?e.since(t):(e.since=t,e.since)},s.parseForRemote=function(e,t){var n,o;o=r({},t);for(n in o)if(o.hasOwnProperty(n)){if(-1!==s.VALID_SPECIAL_ATTRIBUTES.indexOf(n))continue;if(!/^_/.test(n))continue;delete o[n]}return o._id=""+o.type+"/"+o.id,e.prefix&&(o._id=""+e.prefix+o._id),delete o.id,o},s.parseFromRemote=function(e,t){var n,r;return n=t._id||t.id,delete t._id,e.prefix&&(n=n.replace(e.remotePrefixPattern,"")),r=n.match(/([^\/]+)\/(.*)/),t.type=r[1],t.id=r[2],t},s.parseAllFromRemote=function(e,t){return t.map(s.parseFromRemote.bind(null,e))},s.addRevisionTo=function(e,t){var n,r,o,i;return t._rev&&(i=t._rev.split(/-/),r=i[0],n=i[1]),r=parseInt(r,10)||0,o=s.generateNewRevisionId(e),t._$local&&(o+="-local"),t._rev=""+(r+1)+"-"+o,t._revisions={start:1,ids:[o]},n?(t._revisions.start+=r,t._revisions.ids.push(n)):void 0},s.generateNewRevisionId=function(){return i(9)},s.mapDocsFromFindAll=function(e,t){return t.rows.map(function(e){return e.doc})},s.pullUrl=function(e,t){var n=e.remote.getSinceNr(),r=t&&t.forceGzip&&"&force_gzip=true"||"";return e.remote.isConnected()&&!e.isBootstrapping?"/_changes?include_docs=true&since="+n+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+n+r},s.restartPullRequest=function(e){e.pullRequest&&e.pullRequest.abort()},s.handlePullSuccess=function(e,t){s.setSinceNr(e,t.last_seq),s.handlePullResults(e,t.results),e.remote.isConnected()&&e.remote.pull()["catch"](function(){})},s.handlePullError=function(e,t,r){if(e.remote.isConnected())switch(t.status){case 401:return e.remote.trigger("error:unauthenticated",r),e.remote.disconnect()["catch"](function(){});case 404:return n.setTimeout(e.remote.pullSilently,3e3);case 500:return e.remote.trigger("error:server",r),n.setTimeout(e.remote.pullSilently,3e3),e.hoodie.checkConnection()["catch"](function(){});default:return"abort"===t.statusText?e.remote.pull()["catch"](function(){}):(n.setTimeout(e.remote.pullSilently,3e3),e.hoodie.checkConnection()["catch"](function(){}))}},s.handleBootstrapSuccess=function(e){e.isBootstrapping=!1,e.remote.trigger("bootstrap:end")},s.handleBootstrapError=function(e,t){e.isBootstrapping=!1,e.remote.trigger("bootstrap:error",t)},s.handlePullResults=function(e,t){for(var n,r,o,i=e.remote,a=0;a<t.length;a++)if(n=t[a].doc,!(e.prefix&&0!==n._id.indexOf(e.prefix)||e.pushedObjectRevisions[n._rev])){if(o=s.parseFromRemote(e,n),o._deleted){if(!e.remote.isKnownObject(o))continue;r="remove",i.isKnownObject(o)}else i.isKnownObject(o)?r="update":(r="add",i.markAsKnownObject(o));i.trigger(r,o),i.trigger(o.type+":"+r,o),i.trigger(o.type+":"+o.id+":"+r,o),i.trigger("change",r,o),i.trigger(o.type+":change",r,o),i.trigger(o.type+":"+o.id+":change",r,o)}e.pushedObjectRevisions={}},s.pullSilently=function(e){e.remote.pull()["catch"](function(){})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../utils":43,extend:3}],35:[function(e,t,n){var r=e("../api"),o=e("./remotestore"),i=e("./api");t.exports=function(e,t){var n={connected:!1,prefix:"",baseUrl:void 0},s={get baseUrl(){return n.baseUrl},set baseUrl(e){n.baseUrl=e,a.baseUrl=e},get connected(){return n.connected},set connected(e){n.connected=e,a.connected=e},get prefix(){return n.prefix},set prefix(e){n.prefix=e,a.prefix=e},remoteName:null,remotePrefixPattern:new RegExp("^"),since:t.since||0,isBootstrapping:!1,pullRequest:void 0,pullRequestTimeout:void 0,pushRequest:void 0,pushedObjectRevisions:{},knownObjects:{},options:t,hoodie:e},a=r(e,{name:t.name,backend:{save:o.save.bind(null,s),find:o.find.bind(null,s),findAll:o.findAll.bind(null,s),remove:o.remove.bind(null,s),removeAll:o.removeAll.bind(null,s)}});if(void 0!==t.name&&(s.remoteName=t.name),void 0!==t.prefix&&(s.prefix=t.prefix,s.remotePrefixPattern=new RegExp("^"+s.prefix)),null!==t.baseUrl&&(s.baseUrl=t.baseUrl),Object.keys(i).forEach(function(e){"function"==typeof i[e]&&(a[e]=i[e].bind(null,s))}),t.knownObjects)for(var u=0;u<t.knownObjects.length;u++)a.markAsKnownObject({type:t.knownObjects[u].type,id:t.knownObjects[u].id});return s.remote=a,a}},{"../api":31,"./api":33,"./remotestore":36}],36:[function(e,t,n){var r=e("../../../utils"),o=r.generateId,i=e("./helpers"),n=t.exports;n.find=function(e,t,n){var r;return r=t+"/"+n,e.prefix&&(r=e.prefix+r),r="/"+encodeURIComponent(r),e.remote.request("GET",r).then(i.parseFromRemote.bind(null,e))},n.findAll=function(e,t){var n,r,o;switch(r="/_all_docs?include_docs=true",!0){case void 0!==t&&""!==e.prefix:o=e.prefix+t+"/";break;case void 0!==t:o=t+"/";break;case""!==e.prefix:o=e.prefix;break;default:o=""}return o&&(n=o.replace(/.$/,function(e){var t;return t=e.charCodeAt(0),String.fromCharCode(t+1)}),r=r+'&startkey="'+encodeURIComponent(o)+'"&endkey="'+encodeURIComponent(n)+'"'),e.remote.request("GET",r).then(i.mapDocsFromFindAll.bind(null,e)).then(i.parseAllFromRemote.bind(null,e))},n.save=function(e,t){var n,r;return t.id||(t.id=o()),t.createdBy=t.createdBy||e.hoodie.id(),t.updatedAt=(new Date).toJSON(),t.createdAt=t.createdAt||t.updatedAt,n=i.parseForRemote(e,t),r="/"+encodeURIComponent(n._id),e.remote.request("PUT",r,{data:n}).then(function(e){return t._rev=e.rev,t})},n.remove=function(e,t,n){return e.remote.update(t,n,{_deleted:!0})},n.removeAll=function(e,t){return e.remote.updateAll(t,{_deleted:!0})}},{"../../../utils":43,"./helpers":34}],37:[function(e,t,n){var r=e("../../utils"),n=t.exports=function(e,t,o){var i={},s=o.id,a=o.name||"store",u=o.type;return r.events(e,i,[a,u,s].join(":").replace(/:$/,"")),i.decoratePromises=t.decoratePromises,i.validate=t.validate,s?(["save","find","update","remove"].forEach(function(e){i[e]=n[e].bind(null,t,u,s)}),i):(["save","add","find","findOrAdd","findAll","update","updateAll","remove","removeAll"].forEach(function(e){i[e]=n[e].bind(null,t,u)}),i)};n.save=function(e,t,n,r,o){return e.save(t,n,r,o)},n.add=function(e,t,n,r){return e.add(t,n,r)},n.find=function(e,t,n){return e.find(t,n)},n.findOrAdd=function(e,t,n,r){return e.findOrAdd(t,n,r)},n.findAll=function(e,t,n){return e.findAll(t,n)},n.update=function(e,t,n,r,o){return e.update(t,n,r,o)},n.updateAll=function(e,t,n,r){return e.updateAll(t,n,r)},n.remove=function(e,t,n,r){return e.remove(t,n,r)},n.removeAll=function(e,t,n){return e.removeAll(t,n)}},{"../../utils":43}],38:[function(e,t,n){t.exports={scoped:e("./scoped")}},{"./scoped":39}],39:[function(e,t,n){var r=e("../../utils"),n=t.exports=function(e,t,o){var i={},s=o.id,a=o.type;return r.events(e,i,["task",a,s].join(":").replace(/:$/,"")),s?(["abort","restart"].forEach(function(e){i[e]=n[e].bind(null,t,a,s)}),i):(["start","abort","restart","abortAll","restartAll"].forEach(function(e){i[e]=n[e].bind(null,t,a)}),i)};n.start=function(e,t,n){return e.start(t,n)},n.abort=function(e,t,n){return e.abort(t,n)},n.restart=function(e,t,n,r){return e.restart(t,n,r)},n.abortAll=function(e,t){return e.abortAll(t)},n.restartAll=function(e,t,n){return e.restartAll(t,n)}},{"../../utils":43}],40:[function(e,t,n){var r=e("humble-localstorage"),o=e("extend"),n=t.exports=function(e){e=e||"_hoodie_config";var t={get:r.getObject.bind(null,e),set:r.setObject.bind(null,e),remove:r.removeItem.bind(null,e)},o=t.get()||{},i={config:o,store:t};return{set:n.set.bind(null,i),get:n.get.bind(null,i),clear:n.clear.bind(null,i),unset:n.unset.bind(null,i)}};n.set=function(e,t,n){e.config[t]=n,e.store.set(e.config)},n.get=function(e,t){return t?e.config[t]:o({},e.config)},n.clear=function(e){return e.config={},e.store.remove()},n.unset=function(e,t){delete e.config[t],e.store.set(e.config)}},{extend:3,"humble-localstorage":53}],41:[function(e,t,n){var r=e("jqevents"),o=e("extend"),n=t.exports=function(e,t,i){if(t&&i)return n.scopedEventEmitter.apply(null,arguments);var s=r.create();return s.one=s.once,s.bind=s.on,s.unbind=s.off,s.trigger=s.emit=function(e){return function(){try{e.apply(s,arguments)}catch(t){setTimeout(function(){throw t})}}}(s.emit),o(e,s),s};n.METHODS=["on","off","one","trigger","bind","unbind"];var i=/(^|\s)/g;n.scopedEventEmitter=function(e,t,r){var s={};return n.METHODS.forEach(function(t){s[t]=function(){var n=[].slice.call(arguments);n[0]=n[0].replace(i,"$1"+r+":"),e[t].apply(e,n)}}),o(t,s),s}},{extend:3,jqevents:54}],42:[function(e,t,n){var n=t.exports=function(e){return e=e||"0123456789abcdefghijklmnopqrstuvwxyz".split(""),n.generateId.bind(null,e)};n.generateId=function(e,t){var n="",r=e.length;void 0===t&&(t=7);for(var o=0;t>o;o++){var i=Math.random()*r,s=e[Math.floor(i)];n+=String(s).charAt(0)}return n}},{}],43:[function(e,t,n){t.exports={config:e("./config")(),events:e("./events"),generateId:e("./generate_id")(),localStorageWrapper:e("humble-localstorage"),promise:e("./promise")}},{"./config":40,"./events":41,"./generate_id":42,"./promise":45,"humble-localstorage":53}],44:[function(e,t,n){function r(){}function o(e){function t(e,t){return t?function(){var n=t.apply(e,arguments);return n&&n._progressCallbacks&&e._progressCallbacks&&(n._progressCallbacks=n._progressCallbacks.concat(e._progressCallbacks)),n}:null}return e._isHoodiePromise?e:(e._isHoodiePromise=!0,e.done=function(e){return this.then(e)["catch"](r),this},e.fail=function(e){return this.then(null,e)["catch"](r),this},e.always=function(e){return this.then(e,e)["catch"](r),this},e.progress=function(e){return this._progressCallbacks&&this._progressCallbacks.push(e),this},e.then=function(n,r){return e=i.prototype.then.call(this,t(this,n),t(this,r)),o(e),e._progressCallbacks=this._progressCallbacks,e},void(e["catch"]=function(t){return e=i.prototype["catch"].call(this,t),o(e),e}))}var i=e("./promise");t.exports=function(){var e={};return e.promise=new i(function(t,n){e.resolve=function(n){e.notify=function(){},t(n)},e.reject=function(t){e.notify=function(){},n(t)}}),o(e.promise),e.promise._progressCallbacks=[],e.notify=function(){var t=Array.prototype.slice.call(arguments);e.promise._progressCallbacks.forEach(function(e){e.apply(null,t)})},e}},{"./promise":47}],45:[function(e,t,n){t.exports={defer:e("./defer"),isPromise:e("./is_promise"),rejectWith:e("./reject_with"),reject:e("./reject"),resolveWith:e("./resolve_with"),resolve:e("./resolve"),Promise:e("./promise")}},{"./defer":44,"./is_promise":46,"./promise":47,"./reject":48,"./reject_with":49,"./resolve":50,"./resolve_with":51}],46:[function(e,t,n){t.exports=function(e){return e&&e.then?"function"==typeof e.then:!1}},{}],47:[function(e,t,n){(function(n){t.exports=function(){return"function"==typeof n.Promise?n.Promise:e("bluebird")}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bluebird:2}],48:[function(e,t,n){var r=e("./defer");t.exports=function(){var e=r();return e.reject(),e.promise}},{"./defer":44}],49:[function(e,t,n){var r=e("./defer"),o=e("../../lib/error/error");t.exports=function(e){var t=new o(e),n=r();return n.reject(t),n.promise}},{"../../lib/error/error":23,"./defer":44}],50:[function(e,t,n){var r=e("./defer");t.exports=function(){var e=r();return e.resolve(),e.promise}},{"./defer":44}],51:[function(e,t,n){var r=e("./defer");t.exports=function(){var e=r();return e.resolve.apply(e,arguments),e.promise}},{"./defer":44}],52:[function(e,t,n){(function(n){var r=t.exports={},o=e("localstorage-memory");r.hasLocalStorage=e("has-localstorage"),r.create=function(){var e;return r.hasLocalStorage()?(e=n.localStorage,e={get length(){return n.localStorage.length},getItem:n.localStorage.getItem.bind(n.localStorage),setItem:n.localStorage.setItem.bind(n.localStorage),removeItem:n.localStorage.removeItem.bind(n.localStorage),key:n.localStorage.key.bind(n.localStorage),clear:n.localStorage.clear.bind(n.localStorage)},e.isPersistent=!0):(e=o,e.isPersistent=!1),e.getObject=r.getObject.bind(null,e),e.setObject=r.setObject.bind(null,e),e},r.setObject=function(e,t,n){return"object"!=typeof n?e.setItem(t,n):e.setItem(t,JSON.stringify(n))},r.getObject=function(e,t){var n=e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(r){return n}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"has-localstorage":4,
"localstorage-memory":55}],53:[function(e,t,n){var r=e("./api");t.exports=r.create()},{"./api":52}],54:[function(e,t,n){function r(){this.emitting=!1,i.call(this)}function o(e,t){var n=!1;if(Array.isArray(e)&&Array.isArray(t))for(var r=0;r<e.length;r++)if(-1!==t.indexOf(e[r])){n=!0;break}return n}var i=e("events").EventEmitter,s=e("util");s.inherits(r,i),r.prototype.emit=function(e){var t=arguments,n=[],r=this;return e=Array.isArray(e)?e:e.split(" "),e.forEach(function(e){var s,a=[],u=[];if(-1!==e.indexOf(".")&&r._events&&(a=e.split("."),e=a.shift(),s=r._events[e]))if(Array.isArray(s)){if(s.forEach(function(e){o(a,e.__eens)&&u.push(e)}),!u.length)return;r._events[e]=u}else if(0==o(a,s.__eens))return;r.emitting={event:e,namespaces:a},t[0]=e,n.push(i.prototype.emit.apply(r,t)),r.emitting=!1,u.length&&(r._events[e]=s)}),1==n.length?n[0]:n},r.prototype.addListener=function(e,t){var n,r;return-1!==(r=e.indexOf("."))&&"function"==typeof t&&(t=t.bind(),n=e.split("."),e=n.shift(),t.__eens=n),i.prototype.addListener.call(this,e,t)},r.prototype.on=function(e,t){var n,r=Array.isArray(e),o=this;"string"==typeof e||r?(e=r?e:e.split(" "),e.forEach(function(e){o.addListener(e,t)})):"object"==typeof e?(n=Object.keys(e),n.forEach(function(t){o.addListener(t,e[t])})):i.prototype.addListener.call(this,e,t)},r.prototype.removeListener=function(e,t){return-1!==e.indexOf(".")&&(e=e.split(".").shift()),i.prototype.removeListener.call(this,e,t)},r.prototype.removeAllListeners=function(e){var t;return-1!==e.indexOf(".")?(t=e.split("."),e=t.shift(),e?this._offNs(t,e):this._events&&Object.keys(this._events).forEach(this._offNs.bind(this,t))):i.prototype.removeAllListeners.call(this,e),this},r.prototype._offNs=function(e,t){var n=this._events&&this._events[t],r=this;n&&(Array.isArray(n)?n.forEach(function(n){o(e,n.__eens)&&r.removeListener(t,n)}):o(e,n.__eens)&&this.removeListener(t,n))},r.prototype.off=function(e,t){var n,r=Array.isArray(e),o=this,i="function"==typeof t;return"string"==typeof e||r?(e=r?e:e.split(" "),e.forEach(function(e){i?o.removeListener(e,t):o.removeAllListeners(e)})):"object"==typeof e&&(n=Object.keys(e),n.forEach(function(t){"function"==typeof e[t]?o.removeListener(t,e[t]):o.removeAllListeners(t)})),this},t.exports=function(e){return e}.bind(null,new r);var a={};t.exports.create=function(e){var t;return t=e&&a[e]?a[e]:new r},t.exports.EventEmitter=r},{events:1,util:59}],55:[function(e,t,n){!function(e){var r={},o={};r.length=0,r.getItem=function(e){return o[e]||null},r.setItem=function(e,t){"undefined"==typeof t?r.removeItem(e):(o[e]=""+t,r.length++)},r.removeItem=function(e){delete o[e],r.length--},r.key=function(e){return Object.keys(o)[e]||null},r.clear=function(){o={},r.length=0},"object"==typeof n?t.exports=r:e.localStorageMemory=r}(this)},{}],56:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],57:[function(e,t,n){function r(){l=!1,a.length?c=a.concat(c):f=-1,c.length&&o()}function o(){if(!l){var e=setTimeout(r);l=!0;for(var t=c.length;t;){for(a=c,c=[];++f<t;)a&&a[f].run();f=-1,t=c.length}a=null,l=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function s(){}var a,u=t.exports={},c=[],l=!1,f=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new i(e,t)),1!==c.length||l||setTimeout(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],58:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],59:[function(e,t,n){(function(t,r){function o(e,t){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(t)?r.showHidden=t:t&&n._extend(r,t),j(r.showHidden)&&(r.showHidden=!1),j(r.depth)&&(r.depth=2),j(r.colors)&&(r.colors=!1),j(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=i),u(r,e,r.depth)}function i(e,t){var n=o.styles[t];return n?"["+o.colors[n][0]+"m"+e+"["+o.colors[n][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function u(e,t,r){if(e.customInspect&&t&&x(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(r,e);return y(o)||(o=u(e,o,r)),o}var i=c(e,t);if(i)return i;var s=Object.keys(t),v=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),E(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(t);if(0===s.length){if(x(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(w(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(k(t))return e.stylize(Date.prototype.toString.call(t),"date");if(E(t))return l(t)}var _="",m=!1,b=["{","}"];if(h(t)&&(m=!0,b=["[","]"]),x(t)){var j=t.name?": "+t.name:"";_=" [Function"+j+"]"}if(w(t)&&(_=" "+RegExp.prototype.toString.call(t)),k(t)&&(_=" "+Date.prototype.toUTCString.call(t)),E(t)&&(_=" "+l(t)),0===s.length&&(!m||0==t.length))return b[0]+_+b[1];if(0>r)return w(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var A;return A=m?f(e,t,r,v,s):s.map(function(n){return d(e,t,r,v,n,m)}),e.seen.pop(),p(A,_,b)}function c(e,t){if(j(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,o){for(var i=[],s=0,a=t.length;a>s;++s)R(t,String(s))?i.push(d(e,t,n,r,String(s),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(d(e,t,n,r,o,!0))}),i}function d(e,t,n,r,o,i){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),R(r,o)||(s="["+o+"]"),a||(e.seen.indexOf(c.value)<0?(a=g(n)?u(e,c.value,null):u(e,c.value,n-1),a.indexOf("\n")>-1&&(a=i?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),j(s)){if(i&&o.match(/^\d+$/))return a;s=JSON.stringify(""+o),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e,t,n){var r=0,o=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function h(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function g(e){return null===e}function _(e){return null==e}function m(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function j(e){return void 0===e}function w(e){return A(e)&&"[object RegExp]"===T(e)}function A(e){return"object"==typeof e&&null!==e}function k(e){return A(e)&&"[object Date]"===T(e)}function E(e){return A(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function O(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function T(e){return Object.prototype.toString.call(e)}function S(e){return 10>e?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),q[e.getMonth()],t].join(" ")}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var C=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(o(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,i=r.length,s=String(e).replace(C,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return e}}),a=r[n];i>n;a=r[++n])s+=g(a)||!A(a)?" "+a:" "+o(a);return s},n.deprecate=function(e,o){function i(){if(!s){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),s=!0}return e.apply(this,arguments)}if(j(r.process))return function(){return n.deprecate(e,o).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return i};var F,I={};n.debuglog=function(e){if(j(F)&&(F=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!I[e])if(new RegExp("\\b"+e+"\\b","i").test(F)){var r=t.pid;I[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else I[e]=function(){};return I[e]},n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=h,n.isBoolean=v,n.isNull=g,n.isNullOrUndefined=_,n.isNumber=m,n.isString=y,n.isSymbol=b,n.isUndefined=j,n.isRegExp=w,n.isObject=A,n.isDate=k,n.isError=E,n.isFunction=x,n.isPrimitive=O,n.isBuffer=e("./support/isBuffer");var q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",P(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!A(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":58,_process:57,inherits:56}]},{},[5])(5)});